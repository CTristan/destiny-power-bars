{"version":3,"sources":["components/characterDisplay/PowerBars.module.scss","components/CharacterDisplay.module.scss","components/LoadingSpinner.module.scss","App.module.scss","components/characterDisplay/InterPowerBar.module.scss","services/events.ts","services/ga.ts","services/bungie-api.ts","services/bungie-auth.ts","constants.ts","components/characterDisplay/PowerBar.tsx","components/characterDisplay/PowerBars.tsx","components/characterDisplay/InterPowerBar.tsx","components/characterDisplay/Power.tsx","components/characterDisplay/PowerDetails.tsx","components/characterDisplay/PowerHints.tsx","components/CharacterDisplay.tsx","components/FetchSpinner.tsx","components/BuildStamp.tsx","components/KoFi.tsx","images/github.svg","images/twitter.svg","services/vendor-engrams.ts","components/SocialLinks.tsx","components/Footer.tsx","components/Header.tsx","components/LoadingSpinner.tsx","components/LazyImage.tsx","components/LoginPrompt.tsx","components/MembershipSelect.tsx","components/VendorDisplay.tsx","services/utils.ts","services/api.ts","App.tsx","serviceWorker.ts","index.tsx","components/LazyImage.module.scss","components/FetchSpinner.module.scss","components/SocialLinks.module.scss","components/Header.module.scss","components/LoginPrompt.module.scss","components/MembershipSelect.module.scss","components/VendorDisplay.module.scss","components/KoFi.module.scss","components/characterDisplay/PowerDetails.module.scss","components/characterDisplay/PowerHints.module.scss","components/characterDisplay/Power.module.scss","components/BuildStamp.module.scss","images/Ko-fi_Icon_RGBforDarkBg_sm.png","components/Footer.module.scss","images/example-titan-character-display-with-info-blur.jpg","images/example-titan-character-display-with-info.png","components/characterDisplay/PowerBar.module.scss"],"names":["module","exports","EVENTS","eventEmitter","EventEmitter","useEvent","eventName","handler","savedHandler","useRef","useEffect","current","eventListener","eventData","addListener","removeListener","ReactGA","initialize","set","anonymizeIp","pageview","window","location","pathname","search","getCachedManifestDataPromise","cachedManifestData","getManifestPromise","bungieAuthedFetch","config","a","accessToken","getAccessToken","headers","BUNGIE_API_KEY","Authorization","url","params","Object","entries","map","key","value","encodeURIComponent","fetch","credentials","response","status","emit","UNAUTHED_FETCH_ERROR","Error","toString","json","console","error","BungieSystemDisabledError","manifestPropertyWhitelist","getCachedManifestData","log","get","manifestData","getRemoteManifestData","manifest","version","FETCH_MANIFEST_DATA","jsonWorldContentPaths","en","manifestDataResponse","PARSE_MANIFEST_DATA","keys","forEach","includes","STORE_MANIFEST_DATA","localStorage","setItem","getManifest","Promise","resolve","then","ga","event","category","action","nonInteraction","GET_MANIFEST","getDestinyManifest","localStorageManifestVersion","getItem","Response","LOAD_MANIFEST_DATA","every","ErrorStatus","undefined","freshManifestData","result","MANIFEST_DATA_READY","catch","err","MANIFEST_FETCH_ERROR","getBasicProfile","membershipType","membershipId","getProfile","components","destinyMembershipId","getFullProfile","on","removeItem","clearStorage","clearSelectedMembership","hasManuallyAuthed","redirectToAuth","replace","stringify","response_type","client_id","client_secret","manualStartAuth","handleTokenResponse","tokenResponse","data","access_token","tokenDuration","expires_in","expiryTime","Date","now","refreshToken","refresh_token","refreshTokenDuration","refresh_expires_in","refreshExpiryTime","bungieMembershipId","membership_id","getMembershipDataById","destinyMembershipsResponse","authSuccess","destinyMemberships","JSON","selectedMembership","getSelectedDestinyMembership","some","m","length","setSelectedDestinyMembership","fetchAccessToken","authCode","body","grant_type","code","cache","method","redirect","referrer","refreshAccessToken","hasValidAccessToken","accessTokenExpiryTime","parseInt","hasValidRefreshToken","refreshTokenExpiryTime","hasValidAuth","accessTokenIsValid","getDestinyMemberships","destinyMembershipsString","parse","e","message","hasDestinyMemberships","destinyMembershipString","hasSelectedDestinyMembership","membership","auth","queryParams","URLSearchParams","authResponse","origin","isAccessTokenValid","isRefreshTokenValid","logOut","LOG_OUT","ITEM_SLOT_BUCKETS","ITEM_BUCKET_SLOTS","reduce","buckets","slot","bucket","ORDERED_ITEM_SLOTS","ITEM_TYPE_ARMOR","ITEM_TYPE_WEAPON","CLASS_NAMES","PowerBar","min","max","avgValue","label","icon","range","perc","Math","floor","avgPerc","fullLabelText","fullLabel","className","STYLES","classnames","power","belowAverage","slotName","barWrapper","iconWrapper","src","alt","barContainer","filledBar","style","width","barLine","left","classItemNames","hunter","titan","warlock","PowerBars","powerBySlot","slots","topItemBySlot","instanceData","primaryStat","overallPower","roundedPower","minItemPower","values","minPowerToDisplay","maxItemPower","maxItemPowerGrouping","maxPowerToDisplay","ceil","powerBars","powerRange","minPower","rangeLine","maxPower","bars","bestItem","character","characterId","chest","classItem","energy","gloves","head","kinetic","legs","itemDefinition","displayProperties","powerLabel","indicator","InterPowerBar","fillPerc","interPowerBar","bar","fillBar","barOverlay","Power","children","inlinePowerNumber","ProgressBar","withThousands","n","progressBar","title","progressBarFill","progressBarOverlay","PowerDetails","overallPowerExact","artifactData","bonusPower","details","detailsRow","detailsLabel","defailsValue","detailsInlineIcon","iconPath","name","detailsValue","progressToNextLevel","nextLevelAt","PowerHints","potentialOverallPower","powerRequiredToReachNext","powerRequiredToReachPotential","hints","hint","worldDropHint","hintExtra","hintExtraInner","powerfulHint","pinnacleHint","CharacterDisplay","backgroundColor","text","summableArtifactBonusPower","red","green","blue","rgbString","emblemColor","header","emblemBackground","emblemBackgroundPath","substr","toUpperCase","headerOverlayBar","content","characterDisplay","FetchSpinner","fetchSpinnerContainer","anchor","spinner","spinnerSmall","gitHead","process","BuildStamp","buildStamp","Kofi","kofiContainer","link","href","target","rel","height","border","kofiIcon","_extends","assign","i","arguments","source","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","_ref","svgRef","props","role","viewBox","ref","ForwardRef","forwardRef","vendorEngramsData","vendorEngramsRefreshTimer","vendorEngramsRefreshPromise","SocialLinks","socialLinks","fill","Footer","footer","Header","headerContainer","subHeader","author","LoadingSpinner","loading","spinnerLarge","spinnerLargeDouble","spinnerSmallDouble","LazyImage","lowResImage","highResImage","useState","highResImageLoaded","setHighResImageLoaded","onHighResImageLoad","useCallback","lazyImage","hidden","overlay","onLoad","LoginPrompt","loginContainer","exampleImage","ExampleTitanCharacterDisplayImageLowRes","ExampleTitanCharacterDisplayImage","login","loginButton","onClick","defaultOnLogout","MembershipSelect","onMembershipSelect","api","onLogout","bungieAuth","PLATFORMS","1","2","3","4","5","membershipSelect","displayName","VENDOR_ENGRAMS_DROP_NO_DATA","VENDOR_ENGRAMS_DROP_LOW","VENDOR_ENGRAMS_DROP_HIGH","VENDOR_DISPLAY_NAMES","devrim","sloane","failsafe","asher","zavala","shaxx","banshee","fanboy","bray","werner","getVendorDisplayName","shorthand","refreshVendorEngramsData","jsonData","updateTimestamp","getVendorEngramsData","setInterval","warn","Vendor","vendorInner","vendor","manifestVendor","DestinyVendorDefinition","vendorID","high","drop","low","noData","vendorListDisplay","vendors","vendorList","v","vendorListItem","VendorDisplay","vendorData","setVendorData","attemptRefreshVendorData","useInterval","vendorsLastCheckedString","setVendorsLastCheckedString","newString","HumanizeDuration","round","largest","highVendors","filter","display","noDataVendors","vendorDisplay","section","withSeparator","description","getAveragePower","sum","getOverallPower","mergeItems","characterItemMap","allItems","characterItems","concat","items","getBasicCharacterData","pendingBasicProfile","profile","characters","getBasicDataForCharacterId","id","classType","light","characterIds","characterData","mapAndFilterItems","itemInstances","item","itemInstanceId","DestinyInventoryItemDefinition","itemHash","itemType","inventory","bucketTypeHash","canEquip","cannotEquipReason","equipRequiredLevel","baseCharacterLevel","isItemEquippableByCharacter","getItemScore","score","isEquipped","getEquipLabel","equippingBlock","uniqueLabel","getDataForCharacterId","characterInventories","characterEquipments","allCharacterWeapons","profileInventories","profileProgression","relevantProfileItems","itemsBySlot","groupBy","mapValues","maxBy","uniqueEquippedGroups","forIn","uniqueEquippedGroup","validItemCombinations","otherItems","otherItem","isCombinationValid","combination","nonExotics","push","bestCombination","sumBy","getPowerBySlot","artifactItemComponent","flatMap","find","seasonalArtifact","artifactDefinition","powerBonus","powerBonusProgression","potentialPowerBySlot","tempPotentialOverallPower","emblemData","emblemHash","getEmblemData","getCharacterData","currentCharacterData","setCharacterData","setIsFetchingCharacterData","returnBasicCharacterData","pendingManifest","destinyMembership","shouldSetBasicCharacterData","pendingBasicCharacterData","basicCharacterData","fullProfile","characterEquipment","profileInventory","itemComponents","instances","manifestResult","allCharacterItems","bungieApi","utils","App","disableManualLogin","setDisableManualLogin","isAuthed","setIsAuthed","hasAuthError","setAuthError","hasSelectedMembership","setHasMembership","setManifestData","hasManifestError","setManifestError","isBungieSystemDisabled","setBungieSystemDisabled","isFetchingCharacterData","manifestState","setManifestState","hasManifestData","doAuth","doGetManifest","doGetCharacterData","updateCharacterData","newData","newOverallPower","c","newArtifactPower","newTotalPower","dimension1","dimension2","dimension3","onSelectMembership","statusAuthError","charactersContainer","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.be6c68e2.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"powerBars\":\"PowerBars_powerBars__3OF16\",\"powerRange\":\"PowerBars_powerRange__3aluJ\",\"rangeLine\":\"PowerBars_rangeLine__2pL4f\",\"powerLabel\":\"PowerBars_powerLabel__3SEfj\",\"indicator\":\"PowerBars_indicator__e-FBm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"characterDisplay\":\"CharacterDisplay_characterDisplay__3LJ6S\",\"header\":\"CharacterDisplay_header__16L7B\",\"emblemBackground\":\"CharacterDisplay_emblemBackground__2jqgs\",\"emblemSecondarySpecial\":\"CharacterDisplay_emblemSecondarySpecial__3IjoG\",\"emblemSecondaryOverlay\":\"CharacterDisplay_emblemSecondaryOverlay__3Hs71\",\"name\":\"CharacterDisplay_name__3Aw12\",\"power\":\"CharacterDisplay_power__EMI5z\",\"headerOverlayBar\":\"CharacterDisplay_headerOverlayBar__27jyB\",\"content\":\"CharacterDisplay_content__ziCgu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"anchor\":\"LoadingSpinner_anchor__3S34b\",\"spinner\":\"LoadingSpinner_spinner__2W4P9\",\"spin\":\"LoadingSpinner_spin__1qIkq\",\"loading\":\"LoadingSpinner_loading__1Ucdl\",\"spinnerLarge\":\"LoadingSpinner_spinnerLarge__3zeAT\",\"spinnerLargeDouble\":\"LoadingSpinner_spinnerLargeDouble__3hLPj\",\"spinnerSmall\":\"LoadingSpinner_spinnerSmall__25yaq\",\"spinnerSmallDouble\":\"LoadingSpinner_spinnerSmallDouble__OOHcb\",\"status\":\"LoadingSpinner_status__33FO4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App\":\"App_App__4Taua\",\"loadingContainer\":\"App_loadingContainer__1uaFP\",\"charactersContainer\":\"App_charactersContainer__ht0bh\",\"characters\":\"App_characters__1pRqJ\",\"loadingStatus\":\"App_loadingStatus__34OS9\",\"statusAuthError\":\"App_statusAuthError__1x-op\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"interPowerBar\":\"InterPowerBar_interPowerBar__1GuvI\",\"min\":\"InterPowerBar_min__12VD6\",\"max\":\"InterPowerBar_max__1gVKC\",\"bar\":\"InterPowerBar_bar__14-vh\",\"fillBar\":\"InterPowerBar_fillBar__3dFqM\",\"barOverlay\":\"InterPowerBar_barOverlay__2AzRB\"};","import EventEmitter from \"events\";\r\nimport { useEffect, useRef } from \"react\";\r\n\r\nexport enum EVENTS {\r\n  GET_MANIFEST = \"GET_MANIFEST\",\r\n  LOAD_MANIFEST_DATA = \"LOAD_MANIFEST_DATA\",\r\n  FETCH_MANIFEST_DATA = \"FETCH_MANIFEST_DATA\",\r\n  PARSE_MANIFEST_DATA = \"PARSE_MANIFEST_DATA\",\r\n  STORE_MANIFEST_DATA = \"STORE_MANIFEST_DATA\",\r\n  MANIFEST_DATA_READY = \"MANIFEST_DATA_READY\",\r\n  MANIFEST_FETCH_ERROR = \"MANIFEST_FETCH_ERROR\",\r\n\r\n  UNAUTHED_FETCH_ERROR = \"UNAUTHED_FETCH_ERROR\",\r\n\r\n  LOG_OUT = \"LOG_OUT\"\r\n}\r\n\r\nconst eventEmitter = new EventEmitter();\r\n\r\nexport default eventEmitter;\r\n\r\ntype EventHandler<T extends any[]> = (args: T) => void;\r\n\r\nfunction useEvent<T extends any[]>(\r\n  eventName: EVENTS,\r\n  handler: EventHandler<T>\r\n) {\r\n  const savedHandler = useRef<EventHandler<T>>();\r\n\r\n  useEffect(() => {\r\n    savedHandler.current = handler;\r\n  }, [handler]);\r\n\r\n  useEffect(() => {\r\n    const eventListener = (eventData: T) =>\r\n      savedHandler.current && savedHandler.current(eventData);\r\n    eventEmitter.addListener(eventName, eventListener);\r\n    return () => {\r\n      eventEmitter.removeListener(eventName, eventListener);\r\n    };\r\n  }, [eventName]);\r\n}\r\n\r\nexport { useEvent };\r\n","import ReactGA from \"react-ga\";\r\n\r\nReactGA.initialize(\"UA-149614480-1\", {\r\n  // debug: process.env.NODE_ENV === \"development\"\r\n});\r\n\r\n// Anonymize IP addresses, yay GDPR\r\nReactGA.set({ anonymizeIp: true });\r\nReactGA.pageview(window.location.pathname + window.location.search);\r\n\r\nexport default ReactGA;\r\n","import {\n  DestinyInventoryItemDefinition,\n  DestinyManifest,\n  DestinyVendorDefinition,\n  getDestinyManifest,\n  getProfile\n} from \"bungie-api-ts/destiny2\";\nimport { HttpClientConfig } from \"bungie-api-ts/http\";\nimport { get, set } from \"idb-keyval\";\n\nimport { BUNGIE_API_KEY, getAccessToken } from \"./bungie-auth\";\nimport eventEmitter, { EVENTS } from \"./events\";\nimport ga from \"./ga\";\n\nexport const bungieAuthedFetch = async (config: HttpClientConfig) => {\n  try {\n    const accessToken = getAccessToken();\n    const headers: { [key: string]: string } = {\n      \"x-api-key\": BUNGIE_API_KEY\n    };\n    if (accessToken) {\n      headers.Authorization = `Bearer ${accessToken}`;\n    }\n    const url = `${config.url}${\n      config.params\n        ? \"?\" +\n          Object.entries(config.params).map(\n            ([key, value]) =>\n              `${encodeURIComponent(key)}=${encodeURIComponent(\n                value as string\n              )}`\n          )\n        : \"\"\n    }`;\n    const response = await fetch(url, { headers, credentials: \"include\" });\n    if (response.status !== 200) {\n      if (response.status === 401) {\n        eventEmitter.emit(EVENTS.UNAUTHED_FETCH_ERROR);\n      }\n      throw Error(response.status.toString());\n    }\n    return await response.json();\n  } catch (e) {\n    console.error(e);\n    return {};\n  }\n};\n\nexport class BungieSystemDisabledError extends Error {\n  constructor() {\n    super(\"Bungie API disabled\");\n  }\n}\n\nconst MANIFEST_VERSION_KEY = \"MANIFEST_VERSION\";\nconst MANIFEST_IDB_KEY = \"MANIFEST_DATA\";\nexport interface ManifestData {\n  [key: string]: any | undefined;\n  DestinyInventoryItemDefinition: {\n    [key: string]: DestinyInventoryItemDefinition | undefined;\n  };\n  DestinyVendorDefinition: {\n    [key: string]: DestinyVendorDefinition | undefined;\n  };\n}\nconst manifestPropertyWhitelist = [\n  \"DestinyInventoryItemDefinition\",\n  \"DestinyVendorDefinition\"\n];\n\nlet getCachedManifestDataPromise: Promise<ManifestData> | undefined;\nconst getCachedManifestData = async () => {\n  if (!getCachedManifestDataPromise) {\n    getCachedManifestDataPromise = (async () => {\n      console.log(\"Loading manifest data from IDB\");\n      const manifestData = await get(MANIFEST_IDB_KEY);\n      console.log(\"Finished loading manifest data from IDB\");\n      return manifestData as ManifestData;\n    })();\n  }\n  return getCachedManifestDataPromise;\n};\n\nconst getRemoteManifestData = async (manifest: DestinyManifest) => {\n  if (!manifest) {\n    throw Error(\"No manifest!\");\n  }\n  const version = manifest.version;\n  eventEmitter.emit(EVENTS.FETCH_MANIFEST_DATA);\n  const manifestDataResponse = await fetch(\n    `https://www.bungie.net${manifest.jsonWorldContentPaths.en}`\n  );\n  const manifestData: ManifestData = await manifestDataResponse.json();\n  eventEmitter.emit(EVENTS.PARSE_MANIFEST_DATA);\n  Object.keys(manifestData).forEach(key => {\n    if (!manifestPropertyWhitelist.includes(key)) {\n      delete manifestData[key];\n    }\n  });\n  eventEmitter.emit(EVENTS.STORE_MANIFEST_DATA);\n  await set(MANIFEST_IDB_KEY, manifestData);\n  localStorage.setItem(MANIFEST_VERSION_KEY, version);\n  return manifestData;\n};\n\nexport type GetManifestResult =\n  | {\n      manifest: ManifestData;\n      error?: null;\n    }\n  | { manifest: null; error: Error };\n\nlet cachedManifestData: ManifestData | undefined;\nlet getManifestPromise: Promise<GetManifestResult> | undefined;\n\nexport const getManifest = async (): Promise<GetManifestResult> => {\n  if (!getManifestPromise) {\n    getManifestPromise = Promise.resolve()\n      .then(async () => {\n        ga.event({\n          category: \"Data\",\n          action: \"Attempt load manifest\",\n          nonInteraction: true\n        });\n        eventEmitter.emit(EVENTS.GET_MANIFEST);\n        const manifest = await getDestinyManifest(bungieAuthedFetch);\n        const localStorageManifestVersion = localStorage.getItem(\n          MANIFEST_VERSION_KEY\n        );\n        if (\n          manifest &&\n          manifest.Response &&\n          manifest.Response.version === localStorageManifestVersion &&\n          !window.location.search.includes(\"updateManifest\")\n        ) {\n          if (!cachedManifestData) {\n            eventEmitter.emit(EVENTS.LOAD_MANIFEST_DATA);\n            cachedManifestData = await getCachedManifestData();\n          }\n          if (\n            cachedManifestData &&\n            manifestPropertyWhitelist.every(\n              key => cachedManifestData && !!cachedManifestData[key]\n            )\n          ) {\n            return { manifest: cachedManifestData };\n          }\n        }\n        if (\n          manifest &&\n          manifest.ErrorStatus &&\n          manifest.ErrorStatus !== \"Success\"\n        ) {\n          ga.event({\n            category: \"Errors\",\n            action: `Error status \"${manifest.ErrorStatus}\" returned from manifest request`,\n            nonInteraction: true\n          });\n          if (manifest.ErrorStatus === \"SystemDisabled\") {\n            return {\n              manifest: null,\n              error: new BungieSystemDisabledError()\n            };\n          }\n          return {\n            manifest: null,\n            error: Error(\n              `Error status \"${manifest.ErrorStatus}\" returned from manifest request`\n            )\n          };\n        }\n        if (!manifest || !manifest.Response) {\n          throw Error(\"No manifest received!\");\n        }\n        cachedManifestData = undefined;\n        ga.event({\n          category: \"Data\",\n          action: \"Fetch remote manifest\",\n          nonInteraction: true\n        });\n        const freshManifestData = await getRemoteManifestData(\n          manifest.Response\n        );\n        cachedManifestData = freshManifestData;\n        return { manifest: freshManifestData };\n      })\n      .then(result => {\n        if (result.manifest && !result.error) {\n          eventEmitter.emit(EVENTS.MANIFEST_DATA_READY);\n          return result;\n        } else {\n          throw result.error;\n        }\n      })\n      .catch(err => {\n        console.error(err);\n        // Clear manifest promise so it can be re-fetched\n        eventEmitter.emit(EVENTS.MANIFEST_FETCH_ERROR);\n        getManifestPromise = undefined;\n        return { manifest: null, error: err };\n      });\n  }\n  return getManifestPromise;\n};\n\nexport const getBasicProfile = (\n  membershipType: number,\n  membershipId: string\n) => {\n  ga.event({\n    category: \"Character Data\",\n    action: \"Fetch minimal profile\",\n    nonInteraction: true\n  });\n  return getProfile(bungieAuthedFetch, {\n    components: [\n      200, // DestinyComponentType.Characters,\n      205 // DestinyComponentType.CharacterEquipment,\n    ],\n    destinyMembershipId: membershipId,\n    membershipType\n  });\n};\n\nexport const getFullProfile = (\n  membershipType: number,\n  membershipId: string\n) => {\n  ga.event({\n    category: \"Character Data\",\n    action: \"Fetch full profile\",\n    nonInteraction: true\n  });\n  return getProfile(bungieAuthedFetch, {\n    components: [\n      200, // DestinyComponentType.Characters,\n      201, // DestinyComponentType.CharacterInventories,\n      205, // DestinyComponentType.CharacterEquipment,\n      102, // DestinyComponentType.ProfileInventories,\n      300, // DestinyComponentType.ItemInstances,\n      104 // DestinyComponentType.ProfileProgression\n    ],\n    destinyMembershipId: membershipId,\n    membershipType\n  });\n};\n","import { getMembershipDataById, UserInfoCard } from \"bungie-api-ts/user\";\r\nimport { stringify } from \"simple-query-string\";\r\n\r\nimport { bungieAuthedFetch } from \"./bungie-api\";\r\nimport eventEmitter, { EVENTS } from \"./events\";\r\nimport ga from \"./ga\";\r\n\r\nconst isDev = process.env.NODE_ENV === \"development\";\r\nexport const BUNGIE_API_KEY = isDev\r\n  ? \"5b209e9ffcfb4cd69df4c4591199ec54\"\r\n  : \"d216f4575ce8407781070ce5579340ae\";\r\nconst BUNGIE_OAUTH_AUTHORIZE_URL = \"https://www.bungie.net/en/OAuth/Authorize\";\r\nconst BUNGIE_OAUTH_CLIENT_ID = isDev ? \"31115\" : \"31116\";\r\nconst BUNGIE_OAUTH_CLIENT_SECRET = isDev\r\n  ? \"eq5UdbxDmEHcPjqLFPMrlJCVJi0cCgWFWKDPYUnZPWs\"\r\n  : \"TgX91i4g22hBjysd4tffoiOoZRbkox5xH0p2x7mSC4I\";\r\nconst BUNGIE_OAUTH_TOKEN_URL =\r\n  \"https://www.bungie.net/platform/app/oauth/token/\";\r\n\r\nconst ACCESS_TOKEN_STORAGE_KEY = \"bungieAccessToken\";\r\nconst ACCESS_TOKEN_EXPIRY_STORAGE_KEY = \"bungieAccessTokenExpiryTime\";\r\nconst REFRESH_TOKEN_STORAGE_KEY = \"bungieRefreshToken\";\r\nconst REFRESH_TOKEN_EXPIRY_STORAGE_KEY = \"bungieRefreshTokenExpiryTime\";\r\nconst BUNGIE_MEMBERSHIP_ID_STORAGE_KEY = \"bungieMembershipId\";\r\nconst DESTINY_MEMBERSHIPS_STORAGE_KEY = \"destinyMemberships\";\r\nconst DESTINY_MEMBERSHIP_STORAGE_KEY = \"destinyMembership\";\r\nconst MANUAL_AUTHED_STORAGE_KEY = \"manualAuthed\";\r\n\r\neventEmitter.on(EVENTS.UNAUTHED_FETCH_ERROR, () => {\r\n  // If we get 401 from an \"authenticated\" request, assume the access token is invalid\r\n  console.log(\"Clearing invalid access token\");\r\n  localStorage.removeItem(ACCESS_TOKEN_STORAGE_KEY);\r\n});\r\n\r\nconst clearStorage = () => {\r\n  localStorage.removeItem(ACCESS_TOKEN_STORAGE_KEY);\r\n  localStorage.removeItem(ACCESS_TOKEN_EXPIRY_STORAGE_KEY);\r\n  localStorage.removeItem(REFRESH_TOKEN_STORAGE_KEY);\r\n  localStorage.removeItem(REFRESH_TOKEN_EXPIRY_STORAGE_KEY);\r\n  localStorage.removeItem(BUNGIE_MEMBERSHIP_ID_STORAGE_KEY);\r\n  localStorage.removeItem(DESTINY_MEMBERSHIPS_STORAGE_KEY);\r\n};\r\n\r\nconst clearSelectedMembership = () => {\r\n  localStorage.removeItem(DESTINY_MEMBERSHIP_STORAGE_KEY);\r\n};\r\n\r\nexport const hasManuallyAuthed = () => {\r\n  return !!localStorage.getItem(MANUAL_AUTHED_STORAGE_KEY);\r\n};\r\n\r\nconst getAuthUrl = () =>\r\n  `${BUNGIE_OAUTH_AUTHORIZE_URL}?${stringify({\r\n    response_type: \"code\",\r\n    client_id: BUNGIE_OAUTH_CLIENT_ID,\r\n    client_secret: BUNGIE_OAUTH_CLIENT_SECRET\r\n  })}`;\r\n\r\nconst redirectToAuth = () => {\r\n  clearStorage();\r\n  ga.event({\r\n    category: \"Auth\",\r\n    action: \"Redirect for Bungie authentication\",\r\n    nonInteraction: true\r\n  });\r\n  window.location.replace(getAuthUrl());\r\n};\r\n\r\nexport const manualStartAuth = () => {\r\n  localStorage.setItem(MANUAL_AUTHED_STORAGE_KEY, \"TRUE\");\r\n  redirectToAuth();\r\n};\r\n\r\nconst handleTokenResponse = async (\r\n  tokenResponse: Response,\r\n  redirect: boolean = false\r\n) => {\r\n  console.log(\"handleTokenResponse\");\r\n  clearStorage();\r\n  if (tokenResponse.status === 200) {\r\n    const data = await tokenResponse.json();\r\n\r\n    const accessToken = data.access_token as string;\r\n    const tokenDuration = data.expires_in as number;\r\n    const expiryTime = Date.now() + tokenDuration * 1000;\r\n\r\n    const refreshToken = data.refresh_token as string;\r\n    const refreshTokenDuration = data.refresh_expires_in as number;\r\n    const refreshExpiryTime = Date.now() + refreshTokenDuration * 1000;\r\n\r\n    const bungieMembershipId = data.membership_id as string;\r\n\r\n    localStorage.setItem(ACCESS_TOKEN_STORAGE_KEY, accessToken);\r\n    localStorage.setItem(\r\n      ACCESS_TOKEN_EXPIRY_STORAGE_KEY,\r\n      expiryTime.toString()\r\n    );\r\n    localStorage.setItem(REFRESH_TOKEN_STORAGE_KEY, refreshToken);\r\n    localStorage.setItem(\r\n      REFRESH_TOKEN_EXPIRY_STORAGE_KEY,\r\n      refreshExpiryTime.toString()\r\n    );\r\n\r\n    localStorage.setItem(BUNGIE_MEMBERSHIP_ID_STORAGE_KEY, bungieMembershipId);\r\n\r\n    // 254 = all memberships\r\n    const destinyMembershipsResponse = await getMembershipDataById(\r\n      bungieAuthedFetch,\r\n      { membershipId: bungieMembershipId, membershipType: 254 }\r\n    );\r\n\r\n    if (\r\n      !destinyMembershipsResponse ||\r\n      !destinyMembershipsResponse.Response ||\r\n      (destinyMembershipsResponse.ErrorStatus &&\r\n        destinyMembershipsResponse.ErrorStatus !== \"Success\")\r\n    ) {\r\n      ga.event({\r\n        category: \"Errors\",\r\n        action: `Destiny membership fetch error, status: ${destinyMembershipsResponse.ErrorStatus}`,\r\n        nonInteraction: true\r\n      });\r\n      return {\r\n        authSuccess: false,\r\n        error: `Status code ${destinyMembershipsResponse.ErrorStatus} from memberships endpoint`\r\n      };\r\n    }\r\n\r\n    const destinyMemberships =\r\n      destinyMembershipsResponse.Response.destinyMemberships;\r\n    localStorage.setItem(\r\n      DESTINY_MEMBERSHIPS_STORAGE_KEY,\r\n      JSON.stringify(destinyMemberships)\r\n    );\r\n\r\n    // If has stored membership and the membership ID is not in the new list\r\n    // of memberships then clear it\r\n    const selectedMembership = getSelectedDestinyMembership();\r\n    if (\r\n      selectedMembership &&\r\n      !destinyMemberships.some(\r\n        m => m.membershipId === selectedMembership.membershipId\r\n      )\r\n    ) {\r\n      clearSelectedMembership();\r\n    }\r\n\r\n    // If there is only one membership, select it automatically\r\n    if (destinyMemberships.length === 1) {\r\n      setSelectedDestinyMembership(destinyMemberships[0]);\r\n    }\r\n\r\n    return { accessToken, authSuccess: true };\r\n  } else {\r\n    if (tokenResponse.status !== 200) {\r\n      ga.event({\r\n        category: \"Auth\",\r\n        action: `Status code ${tokenResponse.status} from authentication request`,\r\n        nonInteraction: true\r\n      });\r\n      return {\r\n        authSuccess: false,\r\n        error: `Status code ${tokenResponse.status} from authentication request`\r\n      };\r\n    }\r\n  }\r\n};\r\n\r\nconst fetchAccessToken = async (authCode: string) => {\r\n  console.log(\"fetchAccessToken\", authCode);\r\n  clearStorage();\r\n  ga.event({\r\n    category: \"Auth\",\r\n    action: \"Oauth token request\",\r\n    nonInteraction: true\r\n  });\r\n  const tokenResponse = await fetch(BUNGIE_OAUTH_TOKEN_URL, {\r\n    body: stringify({\r\n      grant_type: \"authorization_code\",\r\n      code: authCode,\r\n      client_id: BUNGIE_OAUTH_CLIENT_ID,\r\n      client_secret: BUNGIE_OAUTH_CLIENT_SECRET\r\n    }),\r\n    cache: \"no-cache\",\r\n    credentials: \"include\",\r\n    headers: {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n    },\r\n    method: \"POST\",\r\n    redirect: \"follow\",\r\n    referrer: \"no-referrer\"\r\n  });\r\n  return await handleTokenResponse(tokenResponse);\r\n};\r\n\r\nconst refreshAccessToken = async () => {\r\n  console.log(\"refreshAccessToken\");\r\n  const refreshToken = localStorage.getItem(REFRESH_TOKEN_STORAGE_KEY);\r\n  ga.event({\r\n    category: \"Auth\",\r\n    action: \"Oauth token refresh\",\r\n    nonInteraction: true\r\n  });\r\n  const tokenResponse = await fetch(BUNGIE_OAUTH_TOKEN_URL, {\r\n    body: stringify({\r\n      grant_type: \"refresh_token\",\r\n      refresh_token: refreshToken,\r\n      client_id: BUNGIE_OAUTH_CLIENT_ID,\r\n      client_secret: BUNGIE_OAUTH_CLIENT_SECRET\r\n    }),\r\n    cache: \"no-cache\",\r\n    credentials: \"include\",\r\n    headers: {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n    },\r\n    method: \"POST\",\r\n    redirect: \"follow\",\r\n    referrer: \"no-referrer\"\r\n  });\r\n  return await handleTokenResponse(tokenResponse);\r\n};\r\n\r\nexport const getAccessToken = () => {\r\n  return localStorage.getItem(ACCESS_TOKEN_STORAGE_KEY);\r\n};\r\n\r\nconst hasValidAccessToken = () => {\r\n  const accessToken = getAccessToken();\r\n  const accessTokenExpiryTime = parseInt(\r\n    localStorage.getItem(ACCESS_TOKEN_EXPIRY_STORAGE_KEY) || \"-1\",\r\n    10\r\n  );\r\n\r\n  return accessToken && accessTokenExpiryTime > Date.now();\r\n};\r\n\r\nconst hasValidRefreshToken = () => {\r\n  const refreshToken = localStorage.getItem(REFRESH_TOKEN_STORAGE_KEY);\r\n  const refreshTokenExpiryTime = parseInt(\r\n    localStorage.getItem(REFRESH_TOKEN_EXPIRY_STORAGE_KEY) || \"-1\",\r\n    10\r\n  );\r\n\r\n  return refreshToken && refreshTokenExpiryTime > Date.now();\r\n};\r\n\r\nexport const hasValidAuth = () => {\r\n  const accessTokenIsValid = hasValidAccessToken();\r\n\r\n  const bungieMembershipId = localStorage.getItem(\r\n    BUNGIE_MEMBERSHIP_ID_STORAGE_KEY\r\n  );\r\n  if (!accessTokenIsValid || !bungieMembershipId) {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const getDestinyMemberships = () => {\r\n  const destinyMembershipsString = localStorage.getItem(\r\n    DESTINY_MEMBERSHIPS_STORAGE_KEY\r\n  );\r\n  try {\r\n    if (destinyMembershipsString) {\r\n      return JSON.parse(destinyMembershipsString) as UserInfoCard[];\r\n    }\r\n  } catch (e) {\r\n    ga.event({\r\n      category: \"Data\",\r\n      action: \"Error loading destiny memberships from local storage\",\r\n      nonInteraction: true\r\n    });\r\n    console.error(`Error loading destiny memberships`, e.message);\r\n  }\r\n  return undefined;\r\n};\r\n\r\nexport const hasDestinyMemberships = () => {\r\n  return !!getDestinyMemberships();\r\n};\r\n\r\nexport const getSelectedDestinyMembership = () => {\r\n  const destinyMembershipString = localStorage.getItem(\r\n    DESTINY_MEMBERSHIP_STORAGE_KEY\r\n  );\r\n  try {\r\n    if (destinyMembershipString) {\r\n      return JSON.parse(destinyMembershipString) as UserInfoCard;\r\n    }\r\n  } catch (e) {\r\n    ga.event({\r\n      category: \"Data\",\r\n      action: \"Error loading destiny membership from local storage\",\r\n      nonInteraction: true\r\n    });\r\n    console.error(\"Error loading destiny membership\", e.message);\r\n  }\r\n  return undefined;\r\n};\r\n\r\nexport const hasSelectedDestinyMembership = () => {\r\n  return !!getSelectedDestinyMembership();\r\n};\r\n\r\nexport const setSelectedDestinyMembership = (membership: UserInfoCard) => {\r\n  localStorage.setItem(\r\n    DESTINY_MEMBERSHIP_STORAGE_KEY,\r\n    JSON.stringify(membership)\r\n  );\r\n};\r\n\r\nexport const auth = async (): Promise<boolean> => {\r\n  const queryParams = new URLSearchParams(window.location.search);\r\n  const authCode = queryParams.get(\"code\");\r\n\r\n  if (authCode && !hasValidAuth()) {\r\n    console.log(\"Fetching access token with auth code\");\r\n    const authResponse = await fetchAccessToken(authCode);\r\n    if (authResponse && authResponse.authSuccess === false) {\r\n      console.error(authResponse.error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (authCode) {\r\n    window.location.replace(\r\n      `${window.location.origin}${window.location.pathname}`\r\n    );\r\n  }\r\n\r\n  if (hasValidAuth() && hasDestinyMemberships()) {\r\n    return true;\r\n  }\r\n\r\n  const isAccessTokenValid = hasValidAccessToken();\r\n  const isRefreshTokenValid = hasValidRefreshToken();\r\n\r\n  if (!isAccessTokenValid && isRefreshTokenValid) {\r\n    await refreshAccessToken();\r\n    return auth();\r\n  }\r\n\r\n  if (hasManuallyAuthed()) {\r\n    console.log(\r\n      \"Redirecting to fresh authentication for missing or expired access token, or missing destiny memberships\"\r\n    );\r\n    redirectToAuth();\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const logOut = async () => {\r\n  localStorage.removeItem(MANUAL_AUTHED_STORAGE_KEY);\r\n  clearStorage();\r\n  eventEmitter.emit(EVENTS.LOG_OUT);\r\n};\r\n","export const ITEM_SLOT_KINETIC = \"kinetic\";\r\nexport const ITEM_SLOT_ENERGY = \"energy\";\r\nexport const ITEM_SLOT_POWER = \"power\";\r\nexport const ITEM_SLOT_HEAD = \"head\";\r\nexport const ITEM_SLOT_GLOVES = \"gloves\";\r\nexport const ITEM_SLOT_CHEST = \"chest\";\r\nexport const ITEM_SLOT_LEGS = \"legs\";\r\nexport const ITEM_SLOT_CLASS_ITEM = \"classItem\";\r\n\r\nexport const ITEM_SLOT_BUCKETS = {\r\n  [ITEM_SLOT_KINETIC]: 1498876634,\r\n  [ITEM_SLOT_ENERGY]: 2465295065,\r\n  [ITEM_SLOT_POWER]: 953998645,\r\n  [ITEM_SLOT_HEAD]: 3448274439,\r\n  [ITEM_SLOT_GLOVES]: 3551918588,\r\n  [ITEM_SLOT_CHEST]: 14239492,\r\n  [ITEM_SLOT_LEGS]: 20886954,\r\n  [ITEM_SLOT_CLASS_ITEM]: 1585787867\r\n};\r\n\r\nexport const ITEM_BUCKET_SLOTS = Object.entries(ITEM_SLOT_BUCKETS).reduce(\r\n  (buckets, [slot, bucket]) => ({ ...buckets, [bucket]: slot }),\r\n  {} as { [bucket: number]: string }\r\n);\r\n\r\nexport const ITEM_SLOT_GROUP_WEAPONS = [\r\n  ITEM_SLOT_KINETIC,\r\n  ITEM_SLOT_ENERGY,\r\n  ITEM_SLOT_POWER\r\n];\r\nexport const ITEM_SLOT_GROUP_ARMOR = [\r\n  ITEM_SLOT_HEAD,\r\n  ITEM_SLOT_GLOVES,\r\n  ITEM_SLOT_CHEST,\r\n  ITEM_SLOT_LEGS,\r\n  ITEM_SLOT_CLASS_ITEM\r\n];\r\n\r\nexport const ORDERED_ITEM_SLOTS = [\r\n  ...ITEM_SLOT_GROUP_WEAPONS,\r\n  ...ITEM_SLOT_GROUP_ARMOR\r\n];\r\n\r\nexport const ITEM_TIER_TYPE_EXOTIC = 6;\r\n\r\nexport const ITEM_TYPE_ARMOR = 2;\r\nexport const ITEM_TYPE_WEAPON = 3;\r\n\r\nexport const CLASS_TYPE_ALL = 3;\r\n\r\nexport const CLASS_TITAN = \"titan\";\r\nexport const CLASS_HUNTER = \"hunter\";\r\nexport const CLASS_WARLOCK = \"warlock\";\r\n\r\nexport const CLASS_NAMES = [CLASS_TITAN, CLASS_HUNTER, CLASS_WARLOCK];\r\n\r\nexport const ITEM_TYPE_ARTIFACT = 28;\r\nexport const UNDYING_ARTIFACT_ITEM_HASH = 1387688628;\r\n","import classnames from \"classnames\";\nimport React from \"react\";\n\nimport STYLES from \"./PowerBar.module.scss\";\n\ninterface BarProps {\n  min: number;\n  max: number;\n  value: number;\n  avgValue: number;\n  label: string;\n  icon?: string;\n}\n\nexport const PowerBar = ({\n  min,\n  max,\n  value,\n  avgValue,\n  label,\n  icon\n}: BarProps) => {\n  const range = max - min;\n  const perc = Math.floor(((value - min) / range) * 1000) / 10;\n  const avgPerc = Math.floor(((avgValue - min) / range) * 1000) / 10;\n  // const plusTwoPerc = Math.floor(((avgValue + 2 - min) / range) * 1000) / 10\n  // const plusFivePerc = Math.floor(((avgValue + 5 - min) / range) * 1000) / 10\n  const fullLabelText = `${value} ${label}`;\n  const fullLabel = (\n    <span className={STYLES.label}>\n      <span\n        className={classnames(STYLES.power, {\n          [STYLES.max]: value >= max,\n          [STYLES.belowAverage]: value < avgValue\n        })}\n      >\n        {value}\n      </span>\n      <span className={STYLES.slotName}>{label}</span>\n    </span>\n  );\n  return (\n    <div className={STYLES.barWrapper}>\n      <div className={STYLES.iconWrapper}>\n        {icon && (\n          <img\n            className={STYLES.icon}\n            src={`https://www.bungie.net${icon}`}\n            alt={fullLabelText}\n          />\n        )}\n      </div>\n      <div className={STYLES.barContainer}>\n        <div className={STYLES.filledBar} style={{ width: `${perc}%` }}>\n          {fullLabel}\n        </div>\n        <div className={STYLES.barLine} style={{ left: `${avgPerc}%` }} />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport { ORDERED_ITEM_SLOTS } from \"../../constants\";\nimport { CharacterData, PowerBySlot } from \"../../types\";\nimport { PowerBar } from \"./PowerBar\";\nimport STYLES from \"./PowerBars.module.scss\";\n\nconst classItemNames: { [key: string]: string } = {\n  hunter: \"Hunter Cloak\",\n  titan: \"Titan Mark\",\n  warlock: \"Warlock Bond\"\n};\nconst slotFullNames = (className: string): { [key: string]: string } => ({\n  chest: \"Chest Armor\",\n  classItem: classItemNames[className],\n  energy: \"Energy Weapon\",\n  gloves: \"Gauntlets\",\n  head: \"Helmet\",\n  kinetic: \"Kinetic Weapon\",\n  legs: \"Leg Armor\",\n  power: \"Power Weapon\"\n});\n\ntype PowerBarsProps = CharacterData;\n\nexport const PowerBars = (data: PowerBarsProps) => {\n  // Get power by slot, using overall power if slot data does not exist\n  const powerBySlot = ORDERED_ITEM_SLOTS.reduce(\n    (slots, slotName) => ({\n      ...slots,\n      [slotName]:\n        data.topItemBySlot && data.topItemBySlot[slotName]\n          ? data.topItemBySlot[slotName]!.instanceData.primaryStat.value\n          : data.overallPower\n    }),\n    {} as PowerBySlot\n  );\n\n  const roundedPower = Math.floor(data.overallPower);\n  // Round to 50s\n  const minItemPower = Math.min(...Object.values(powerBySlot));\n  const minPowerToDisplay = Math.max(\n    Math.floor(minItemPower / 50) * 50 - 50,\n    0\n  );\n  const maxItemPower = Math.max(...Object.values(powerBySlot));\n  const maxItemPowerGrouping = maxItemPower <= 950 ? 50 : 10;\n  const maxPowerToDisplay =\n    Math.ceil(maxItemPower / maxItemPowerGrouping) * maxItemPowerGrouping;\n\n  const range = maxPowerToDisplay - minPowerToDisplay;\n  const perc =\n    Math.floor(((roundedPower - minPowerToDisplay) / range) * 1000) / 10;\n\n  return (\n    <div className={STYLES.powerBars}>\n      <div className={STYLES.powerRange}>\n        <div className={STYLES.minPower}>{minPowerToDisplay}</div>\n        <div className={STYLES.rangeLine} />\n        <div className={STYLES.maxPower}>{maxPowerToDisplay}</div>\n      </div>\n      <div className={STYLES.bars}>\n        {Object.entries(powerBySlot).map(([slotName, power]) => {\n          const bestItem = data.topItemBySlot && data.topItemBySlot[slotName];\n          return (\n            <PowerBar\n              key={`${data.character.characterId}_${slotName}`}\n              min={minPowerToDisplay}\n              max={maxPowerToDisplay}\n              value={power}\n              avgValue={roundedPower}\n              label={slotFullNames(data.className)[slotName] || slotName}\n              icon={\n                bestItem &&\n                bestItem.itemDefinition &&\n                bestItem.itemDefinition.displayProperties.icon\n              }\n            />\n          );\n        })}\n      </div>\n      <div className={STYLES.powerLabel}>\n        <div className={STYLES.indicator} style={{ left: `${perc}%` }}>\n          {roundedPower}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\r\n\r\nimport STYLES from \"./InterPowerBar.module.scss\";\r\n\r\ninterface InterPowerBarProps {\r\n  value: number;\r\n}\r\n\r\nexport const InterPowerBar = ({ value }: InterPowerBarProps) => {\r\n  const max = Math.ceil(value);\r\n  const min = value === max ? value - 1 : Math.floor(value);\r\n\r\n  const fillPerc = Math.floor(value * 100 - min * 100);\r\n\r\n  return (\r\n    <div className={STYLES.interPowerBar}>\r\n      <div className={STYLES.min}>{min}</div>\r\n      <div className={STYLES.bar}>\r\n        <div className={STYLES.fillBar} style={{ width: `${fillPerc}%` }} />\r\n        <div className={STYLES.barOverlay} />\r\n      </div>\r\n      <div className={STYLES.max}>{max}</div>\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\n\nimport STYLES from \"./Power.module.scss\";\n\ninterface PowerProps {\n  children: number | string;\n}\nexport const Power = ({ children }: PowerProps) => (\n  <span className={STYLES.inlinePowerNumber}>{children}</span>\n);\n","import React from \"react\";\n\nimport STYLES from \"./PowerDetails.module.scss\";\n\nimport { InterPowerBar } from \"./InterPowerBar\";\nimport { Power } from \"./Power\";\n\nconst withSign = (value: number) => {\n  if (value >= 0) {\n    return `+${value}`;\n  }\n  return `${value}`;\n};\n\nconst ProgressBar = ({ value, max }: { value: number; max: number }) => {\n  const perc = Math.floor((value / max) * 1000) / 10;\n  const withThousands = (n: number) =>\n    n.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  return (\n    <div\n      className={STYLES.progressBar}\n      title={`${withThousands(value)} / ${withThousands(max)}`}\n    >\n      <div className={STYLES.progressBarFill} style={{ width: `${perc}%` }} />\n      <div className={STYLES.progressBarOverlay} />\n    </div>\n  );\n};\n\ninterface PowerDetailsProps {\n  overallPowerExact: number;\n  overallPower: number;\n  artifactData?: {\n    name: string;\n    iconPath: string;\n    bonusPower: number;\n    progressToNextLevel: number;\n    nextLevelAt: number;\n  };\n}\n\nexport const PowerDetails = ({\n  overallPowerExact,\n  overallPower,\n  artifactData\n}: PowerDetailsProps) => {\n  const roundedPower = Math.floor(overallPower);\n\n  if (!artifactData || artifactData.bonusPower === 0) {\n    return null;\n  }\n\n  return (\n    <div className={STYLES.details}>\n      <div className={STYLES.detailsRow}>\n        <div className={STYLES.detailsLabel}>\n          Maximum equippable gear power:\n        </div>\n        <div className={STYLES.defailsValue}>\n          <Power>{roundedPower}</Power>\n        </div>\n      </div>\n      <div className={STYLES.detailsRow}>\n        <InterPowerBar value={overallPowerExact} />\n      </div>\n      {artifactData && (\n        <>\n          <div className={STYLES.detailsRow}>\n            <div className={STYLES.detailsLabel}>\n              <img\n                className={STYLES.detailsInlineIcon}\n                src={`https://www.bungie.net${artifactData.iconPath}`}\n                alt=\"\"\n              />\n              {artifactData.name} bonus power:\n            </div>\n            <div className={STYLES.detailsValue}>\n              <Power>{withSign(artifactData.bonusPower)}</Power>\n            </div>\n          </div>\n          <div className={STYLES.detailsRow}>\n            <ProgressBar\n              value={artifactData.progressToNextLevel}\n              max={artifactData.nextLevelAt}\n            />\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n","import classnames from \"classnames\";\nimport React from \"react\";\n\nimport { Power } from \"./Power\";\n\nimport STYLES from \"./PowerHints.module.scss\";\n\ninterface PowerHintsProps {\n  overallPowerExact: number;\n  overallPower: number;\n  potentialOverallPower?: number;\n}\n\nexport const PowerHints = ({\n  overallPowerExact,\n  overallPower,\n  potentialOverallPower\n}: PowerHintsProps) => {\n  potentialOverallPower = potentialOverallPower || Math.min(900, overallPower);\n\n  const nextPower =\n    overallPowerExact === overallPower\n      ? overallPower + 1\n      : Math.ceil(overallPowerExact);\n\n  const powerRequiredToReachNext = (nextPower - overallPowerExact) * 8;\n  const powerRequiredToReachPotential =\n    (potentialOverallPower - overallPowerExact) * 8;\n\n  return (\n    <div className={STYLES.hints}>\n      {potentialOverallPower && potentialOverallPower > overallPower && (\n        <div className={classnames(STYLES.hint, STYLES.worldDropHint)}>\n          <span>\n            World drops can increase your overall gear power to{\" \"}\n            <Power>{potentialOverallPower}</Power>\n          </span>\n          <div className={STYLES.hintExtra}>\n            <div className={STYLES.hintExtraInner}>\n              <div>\n                World drops (from strikes, public events,{\" \"}\n                {overallPower <= 950 && \"vendors, \"}non-powerful legendary\n                rewards) can drop with a power level from{\" \"}\n                <Power>{overallPower - 3}</Power> to{\" \"}\n                <Power>{overallPower}</Power> for this character.\n              </div>\n              <div>\n                Replacing items below your current overall power can increase\n                your power to a higher average.\n              </div>\n              {powerRequiredToReachNext &&\n                powerRequiredToReachNext !== powerRequiredToReachPotential && (\n                  <div>\n                    You need an extra <Power>{powerRequiredToReachNext}</Power>{\" \"}\n                    total power on your items to reach an overall power of{\" \"}\n                    <Power>{Math.floor(overallPower + 1)}</Power>.\n                  </div>\n                )}\n              {powerRequiredToReachPotential && (\n                <div>\n                  You need an extra{\" \"}\n                  <Power>{powerRequiredToReachPotential}</Power> total power on\n                  your items to reach an overall power of{\" \"}\n                  <Power>{potentialOverallPower}</Power>.\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {potentialOverallPower === overallPower &&\n        overallPower >= 900 &&\n        overallPower < 950 && (\n          <div className={classnames(STYLES.hint, STYLES.powerfulHint)}>\n            <span>\n              Powerful rewards can increase your overall gear power up to the\n              powerful cap of <Power>{950}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  Powerful and pinnacle reward sources (Weekly challenges, Year\n                  3 raids) will give you items above your overall gear power,\n                  with powerful rewards capped at <Power>{950}</Power>.\n                </div>\n                {powerRequiredToReachNext && (\n                  <div>\n                    You need an extra <Power>{powerRequiredToReachNext}</Power>{\" \"}\n                    total power on your items to reach an overall power of{\" \"}\n                    <Power>{Math.floor(overallPower + 1)}</Power>.\n                  </div>\n                )}\n                <div>\n                  After getting a powerful reward, check back here to see if\n                  it's beneficial to catch up the rest of your slots with world\n                  drops before getting another!\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n      {potentialOverallPower === overallPower &&\n        overallPower >= 950 &&\n        overallPower < 960 && (\n          <div className={classnames(STYLES.hint, STYLES.pinnacleHint)}>\n            <span>\n              Pinnacle rewards can increase your overall gear power up to the\n              pinnacle cap of <Power>{960}</Power>\n            </span>\n            <div className={STYLES.hintExtra}>\n              <div className={STYLES.hintExtraInner}>\n                <div>\n                  Pinnacle reward sources (Some weekly challenges, Year 3 raids)\n                  will give you items at{\" \"}\n                  <Power>{Math.min(overallPower + 2, 960)}</Power> power.\n                </div>\n                {powerRequiredToReachNext && (\n                  <div>\n                    You need an extra <Power>{powerRequiredToReachNext}</Power>{\" \"}\n                    total power on your items to reach an overall power of{\" \"}\n                    <Power>{Math.floor(overallPower + 1)}</Power>.\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n    </div>\n  );\n};\n","import React from \"react\";\r\n\r\nimport { CharacterData } from \"../types\";\r\nimport STYLES from \"./CharacterDisplay.module.scss\";\r\nimport { PowerBars } from \"./characterDisplay/PowerBars\";\r\nimport { PowerDetails } from \"./characterDisplay/PowerDetails\";\r\nimport { PowerHints } from \"./characterDisplay/PowerHints\";\r\n\r\ninterface CharacterDisplayProps {\r\n  data: CharacterData;\r\n}\r\n\r\nconst titleCase = (text: string) =>\r\n  text.substr(0, 1).toUpperCase() + text.substr(1);\r\n\r\nconst rgbString = ({\r\n  red,\r\n  green,\r\n  blue\r\n}: {\r\n  red: number;\r\n  green: number;\r\n  blue: number;\r\n}) => `rgb(${red},${green},${blue})`;\r\n\r\nexport const CharacterDisplayBodyWrapper = (\r\n  backgroundColor: string,\r\n  children: JSX.Element\r\n) => (\r\n  <div className={STYLES.characterDisplay} style={{ backgroundColor }}>\r\n    {children}\r\n  </div>\r\n);\r\n\r\nconst CharacterDisplay = ({ data }: CharacterDisplayProps) => {\r\n  const roundedPower = Math.floor(data.overallPower);\r\n\r\n  const summableArtifactBonusPower = data.artifactData\r\n    ? data.artifactData.bonusPower\r\n    : 0;\r\n\r\n  return CharacterDisplayBodyWrapper(\r\n    rgbString(data.character.emblemColor),\r\n    <>\r\n      <div className={STYLES.header}>\r\n        <img\r\n          className={STYLES.emblemBackground}\r\n          src={`https://www.bungie.net${data.character.emblemBackgroundPath}`}\r\n          alt=\"\"\r\n        />\r\n        <div className={STYLES.name}>{titleCase(data.className)}</div>\r\n        <div className={STYLES.power}>\r\n          {roundedPower + summableArtifactBonusPower}\r\n        </div>\r\n        <div className={STYLES.headerOverlayBar} />\r\n      </div>\r\n\r\n      <div className={STYLES.content}>\r\n        <PowerDetails {...data} />\r\n        <PowerBars {...data} />\r\n        <PowerHints {...data} />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CharacterDisplay;\r\n","import React from \"react\";\n\nimport STYLES from \"./FetchSpinner.module.scss\";\n\nconst FetchSpinner = () => (\n  <div className={STYLES.fetchSpinnerContainer}>\n    <div className={STYLES.anchor}>\n      <div className={STYLES.spinner} />\n      <div className={STYLES.spinnerSmall} />\n    </div>\n  </div>\n);\n\nexport default FetchSpinner;\n","import preval from \"preval.macro\";\nimport React from \"react\";\n\nimport STYLES from \"./BuildStamp.module.scss\";\n\nconst gitHead = (process.env.REACT_APP_NPM_PACKAGE_GITHEAD || \"\").substr(0, 6);\n\nconst buildTimestamp = preval`module.exports = new Date().toISOString();`;\n\nexport const BuildStamp = () => (\n  <div className={STYLES.buildStamp}>\n    {gitHead} {buildTimestamp}\n  </div>\n);\n","import React from \"react\";\n\nimport kofiIcon from \"../images/Ko-fi_Icon_RGBforDarkBg_sm.png\";\n\nimport STYLES from \"./KoFi.module.scss\";\n\nexport const Kofi = () => {\n  return (\n    <div className={STYLES.kofiContainer}>\n      <a\n        className={STYLES.link}\n        href=\"https://ko-fi.com/tomcorke\"\n        /* eslint-disable-next-line react/jsx-no-target-blank */\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        <img\n          height=\"36\"\n          style={{ border: \"0px\", height: \"36px\" }}\n          src={kofiIcon}\n          alt=\"Buy Me a Coffee at ko-fi.com\"\n        />\n        <span>Buy me a coffee</span>\n      </a>\n    </div>\n  );\n};\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"title\", null, \"GitHub icon\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"\n});\n\nvar SvgGithub = function SvgGithub(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    role: \"img\",\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title === undefined ? _ref2 : title ? React.createElement(\"title\", null, title) : null, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgGithub, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/github.617870e4.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"title\", null, \"Twitter icon\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z\"\n});\n\nvar SvgTwitter = function SvgTwitter(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    role: \"img\",\n    viewBox: \"0 0 24 24\",\n    ref: svgRef\n  }, props), title === undefined ? _ref2 : title ? React.createElement(\"title\", null, title) : null, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgTwitter, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/twitter.be066898.svg\";\nexport { ForwardRef as ReactComponent };","const VENDOR_ENGRAMS_API_ENDPOINT =\n  \"https://api.vendorengrams.xyz/getVendorDrops?source=destiny-power-bars\";\n\nexport interface VendorEngramsVendorData {\n  vendorID: string;\n  display: string;\n  drop: string;\n  shorthand: string;\n  interval: string;\n  nextRefresh: string;\n}\n\nexport interface VendorEngramsData {\n  data: VendorEngramsVendorData[];\n  updateTimestamp: number;\n}\n\nexport const VENDOR_ENGRAMS_DROP_NO_DATA = \"0\";\nexport const VENDOR_ENGRAMS_DROP_LOW = \"1\";\nexport const VENDOR_ENGRAMS_DROP_HIGH = \"2\";\n\nconst VENDOR_DISPLAY_NAMES: { [shorthand: string]: string } = {\n  devrim: \"Devrim Kay (EDZ)\",\n  sloane: \"Sloane (Titan)\",\n  failsafe: \"Failsafe (Nessus)\",\n  asher: \"Asher Mir (Io)\",\n  zavala: \"Zavala (Vanguard, Tower)\",\n  shaxx: \"Shaxx (Crucible, Tower)\",\n  banshee: \"Banshee-44 (Gunsmith, Tower)\",\n  // benedict: \"Benedict\",\n  // saladin: \"Lord Saladin (Iron Banner, Tower)\",\n  fanboy: \"Brother Vance (Mercury)\",\n  bray: \"Ana Bray (Mars)\",\n  werner: \"Werner 99-40 (Tower, Nessus Barge)\"\n};\nexport const getVendorDisplayName = (shorthand: string) => {\n  return VENDOR_DISPLAY_NAMES[shorthand] || shorthand;\n};\n\nlet vendorEngramsData: VendorEngramsData | undefined;\nlet vendorEngramsRefreshTimer: number | NodeJS.Timeout | undefined;\nlet vendorEngramsRefreshPromise: Promise<VendorEngramsData> | undefined;\n\nconst VENDOR_ENGRAMS_REFRESH_DELAY = 5 * 60 * 1000;\n\nconst refreshVendorEngramsData = async () => {\n  const response = await fetch(VENDOR_ENGRAMS_API_ENDPOINT);\n  const jsonData = (await response.json()) as VendorEngramsVendorData[];\n  const updateTimestamp = Date.now();\n  const data = { data: jsonData, updateTimestamp };\n  vendorEngramsData = data;\n  return data;\n};\n\nexport const getVendorEngramsData = async () => {\n  if (vendorEngramsData) {\n    return vendorEngramsData;\n  }\n  if (!vendorEngramsRefreshPromise) {\n    vendorEngramsRefreshPromise = refreshVendorEngramsData();\n  }\n  if (!vendorEngramsRefreshTimer) {\n    vendorEngramsRefreshTimer = setInterval(() => {\n      refreshVendorEngramsData().catch(e =>\n        console.warn(\"Error refreshing vendorengrams.xyz data\", e)\n      );\n    }, VENDOR_ENGRAMS_REFRESH_DELAY);\n  }\n  return vendorEngramsRefreshPromise;\n};\n","import React from \"react\";\n\nimport { Kofi } from \"./KoFi\";\n\nimport { ReactComponent as GitHubLogo } from \"../images/github.svg\";\nimport { ReactComponent as TwitterLogo } from \"../images/twitter.svg\";\n\nimport STYLES from \"./SocialLinks.module.scss\";\n\nexport const SocialLinks = () => (\n  <div className={STYLES.socialLinks}>\n    <div className={STYLES.link}>\n      <Kofi />\n    </div>\n    <a\n      className={STYLES.link}\n      href=\"https://www.twitter.com/corke_tom\"\n      target=\"_blank\"\n      rel=\"noreferrer noopener\"\n    >\n      <TwitterLogo\n        width={20}\n        height={20}\n        style={{ fill: \"rgba(255,255,255,0.8)\" }}\n      />\n    </a>\n    <a\n      className={STYLES.link}\n      href=\"https://github.com/tomcorke/destiny-power-bars\"\n      target=\"_blank\"\n      rel=\"noreferrer noopener\"\n    >\n      <GitHubLogo\n        width={20}\n        height={20}\n        style={{ fill: \"rgba(255,255,255,0.8)\" }}\n      />\n    </a>\n  </div>\n);\n","import React from \"react\";\n\nimport { BuildStamp } from \"./BuildStamp\";\nimport { SocialLinks } from \"./SocialLinks\";\n\nimport STYLES from \"./Footer.module.scss\";\n\nexport const Footer = () => {\n  return (\n    <div className={STYLES.footer}>\n      <SocialLinks />\n      <BuildStamp />\n    </div>\n  );\n};\n","import React from \"react\";\n\nimport STYLES from \"./Header.module.scss\";\n\nexport const Header = () => (\n  <div className={STYLES.headerContainer}>\n    <div className={STYLES.header}>Destiny Power Bars</div>\n    <div className={STYLES.subHeader}>\n      by{\" \"}\n      <a\n        className={STYLES.author}\n        href=\"https://twitter.com/corke_tom\"\n        rel=\"noreferrer noopener\"\n        target=\"_blank\"\n      >\n        Tom Corke\n      </a>\n    </div>\n  </div>\n);\n","import React from \"react\";\n\nimport STYLES from \"./LoadingSpinner.module.scss\";\n\ninterface LoadingSpinnerProps {\n  children: string | JSX.Element;\n}\n\nconst LoadingSpinner = ({ children }: LoadingSpinnerProps) => {\n  return (\n    <div className={STYLES.loading}>\n      <div className={STYLES.anchor}>\n        <div className={STYLES.spinnerLarge} />\n        <div className={STYLES.spinnerLargeDouble} />\n        <div className={STYLES.spinnerSmall} />\n        <div className={STYLES.spinnerSmallDouble} />\n      </div>\n      <div className={STYLES.status}>{children}</div>\n    </div>\n  );\n};\n\nexport default LoadingSpinner;\n","import classnames from \"classnames\";\r\nimport React, { useCallback, useState } from \"react\";\r\n\r\nimport STYLES from \"./LazyImage.module.scss\";\r\n\r\ninterface LazyImageProps {\r\n  lowResImage: string;\r\n  highResImage: string;\r\n  delay?: number;\r\n  alt?: string;\r\n}\r\n\r\nexport const LazyImage = ({\r\n  lowResImage,\r\n  highResImage,\r\n  alt = \"\"\r\n}: LazyImageProps) => {\r\n  const [highResImageLoaded, setHighResImageLoaded] = useState(false);\r\n\r\n  const onHighResImageLoad = useCallback(() => {\r\n    setHighResImageLoaded(true);\r\n  }, [setHighResImageLoaded]);\r\n\r\n  const result = (\r\n    <div className={STYLES.lazyImage}>\r\n      <img\r\n        src={highResImage}\r\n        alt={alt}\r\n        className={classnames({\r\n          [STYLES.hidden]: !highResImageLoaded,\r\n          [STYLES.overlay]: !highResImageLoaded\r\n        })}\r\n        onLoad={onHighResImageLoad}\r\n      />\r\n      <img\r\n        src={lowResImage}\r\n        alt={alt}\r\n        className={classnames({\r\n          [STYLES.hidden]: highResImageLoaded,\r\n          [STYLES.overlay]: highResImageLoaded\r\n        })}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return result;\r\n};\r\n","import React from \"react\";\n\nimport { manualStartAuth } from \"../services/bungie-auth\";\nimport { LazyImage } from \"./LazyImage\";\n\nimport ExampleTitanCharacterDisplayImageLowRes from \"../images/example-titan-character-display-with-info-blur.jpg\";\nimport ExampleTitanCharacterDisplayImage from \"../images/example-titan-character-display-with-info.png\";\nimport STYLES from \"./LoginPrompt.module.scss\";\n\nexport const LoginPrompt = () => {\n  return (\n    <div className={STYLES.loginContainer}>\n      <div className={STYLES.exampleImage}>\n        <LazyImage\n          lowResImage={ExampleTitanCharacterDisplayImageLowRes}\n          highResImage={ExampleTitanCharacterDisplayImage}\n          alt=\"Example Destiny Power Bars\"\n        />\n      </div>\n      <div className={STYLES.login}>\n        <div>\n          Destiny Power Bars requires access to your inventory and vault to\n          determine your maximum power per slot and character. Please log in to\n          Bungie.net to authorize this application.\n        </div>\n        <button\n          className={STYLES.loginButton}\n          onClick={() => manualStartAuth()}\n        >\n          Log in with Bungie.net\n        </button>\n      </div>\n    </div>\n  );\n};\n","import { UserInfoCard } from \"bungie-api-ts/user\";\nimport classnames from \"classnames\";\nimport React from \"react\";\n\nimport { PartialApi } from \"../services/api\";\nimport { logOut } from \"../services/bungie-auth\";\nimport STYLES from \"./MembershipSelect.module.scss\";\n\nexport interface RequiredApi extends PartialApi {\n  bungieAuth: {\n    getDestinyMemberships: () => UserInfoCard[] | undefined;\n  };\n}\n\ninterface MembershipSelectProps {\n  onMembershipSelect: (membership: UserInfoCard) => any;\n  api: RequiredApi;\n  onLogout?: () => void;\n}\n\nconst defaultOnLogout = () => logOut();\n\nconst MembershipSelect = ({\n  onMembershipSelect,\n  api,\n  onLogout = defaultOnLogout\n}: MembershipSelectProps) => {\n  const destinyMemberships = api.bungieAuth.getDestinyMemberships();\n\n  if (!destinyMemberships) {\n    return null;\n  }\n\n  if (destinyMemberships.length === 0) {\n    return <div>No destiny memberships!</div>;\n  }\n\n  const PLATFORMS: { [key: number]: string } = {\n    1: \"xbox\",\n    2: \"psn\",\n    3: \"steam\",\n    4: \"blizzard\",\n    5: \"stadia\"\n  };\n\n  return (\n    <div className={STYLES.membershipSelect}>\n      {destinyMemberships.map(m => {\n        return (\n          <div\n            key={m.membershipId}\n            className={classnames(\n              STYLES.membership,\n              STYLES[`platform_${PLATFORMS[m.membershipType]}`]\n            )}\n            onClick={() => onMembershipSelect(m)}\n          >\n            {m.displayName}\n          </div>\n        );\n      })}\n      <button\n        className={STYLES.logOut}\n        onClick={() => onLogout()}\n        title=\"Log out\"\n      >\n        <span>Re-authenticate</span>\n      </button>\n    </div>\n  );\n};\n\nexport default MembershipSelect;\n","import useInterval from \"@use-it/interval\";\nimport classnames from \"classnames\";\nimport HumanizeDuration from \"humanize-duration\";\nimport React, { useEffect, useState } from \"react\";\n\nimport { ManifestData } from \"../services/bungie-api\";\nimport {\n  getVendorDisplayName,\n  getVendorEngramsData,\n  VENDOR_ENGRAMS_DROP_HIGH,\n  VENDOR_ENGRAMS_DROP_LOW,\n  VENDOR_ENGRAMS_DROP_NO_DATA,\n  VendorEngramsData,\n  VendorEngramsVendorData\n} from \"../services/vendor-engrams\";\nimport { Power } from \"./characterDisplay/Power\";\n\nimport STYLES from \"./VendorDisplay.module.scss\";\n\nconst VENDOR_DATA_REFRESH_ATTEMPT_DELAY = 10 * 1000;\n\ninterface VendorProps {\n  vendor: VendorEngramsVendorData;\n  manifestData: ManifestData;\n}\nexport const Vendor = ({ vendor, manifestData }: VendorProps) => {\n  const manifestVendor = manifestData.DestinyVendorDefinition[vendor.vendorID];\n  let vendorInner: JSX.Element | string;\n\n  if (!manifestVendor) {\n    vendorInner = getVendorDisplayName(vendor.shorthand);\n  } else {\n    vendorInner = (\n      <>\n        <img\n          className={STYLES.icon}\n          src={`https://www.bungie.net${manifestVendor.displayProperties.icon}`}\n          alt=\"\"\n        />\n        {manifestVendor.displayProperties.name}\n      </>\n    );\n  }\n  return (\n    <div\n      className={classnames(STYLES.vendor, {\n        [STYLES.high]: vendor.drop === VENDOR_ENGRAMS_DROP_HIGH,\n        [STYLES.low]: vendor.drop === VENDOR_ENGRAMS_DROP_LOW,\n        [STYLES.noData]: vendor.drop === VENDOR_ENGRAMS_DROP_NO_DATA\n      })}\n    >\n      {vendorInner}\n    </div>\n  );\n};\n\nconst vendorListDisplay = (\n  vendors: VendorEngramsVendorData[],\n  manifestData: ManifestData\n) => {\n  return (\n    <ul className={STYLES.vendorList}>\n      {vendors.map(v => (\n        <li className={STYLES.vendorListItem} key={v.shorthand}>\n          <Vendor manifestData={manifestData} vendor={v} />\n        </li>\n      ))}\n    </ul>\n  );\n};\n\ninterface VendorDisplayProps {\n  manifestData?: ManifestData;\n}\n\nexport const VendorDisplay = ({ manifestData }: VendorDisplayProps) => {\n  const [vendorData, setVendorData] = useState<VendorEngramsData | undefined>(\n    undefined\n  );\n\n  const attemptRefreshVendorData = () => {\n    getVendorEngramsData()\n      .then(data => setVendorData(data))\n      .catch(e => console.warn(`Error fetching vendor engrams data:`, e));\n  };\n  useInterval(attemptRefreshVendorData, VENDOR_DATA_REFRESH_ATTEMPT_DELAY);\n  useEffect(attemptRefreshVendorData, []);\n\n  const [vendorsLastCheckedString, setVendorsLastCheckedString] = useState<\n    string | null\n  >(null);\n\n  useInterval(() => {\n    if (!vendorData) {\n      setVendorsLastCheckedString(null);\n      return;\n    }\n\n    const newString = HumanizeDuration(\n      vendorData.updateTimestamp - Date.now(),\n      {\n        round: true,\n        largest: 1\n      }\n    );\n    setVendorsLastCheckedString(newString);\n  }, 1000);\n\n  if (!manifestData) {\n    return null;\n  }\n\n  const highVendors =\n    (vendorData &&\n      vendorData.data.filter(\n        v => v.drop === VENDOR_ENGRAMS_DROP_HIGH && v.display === \"1\"\n      )) ||\n    [];\n\n  const noDataVendors =\n    (vendorData &&\n      vendorData.data.filter(\n        v => v.drop === VENDOR_ENGRAMS_DROP_NO_DATA && v.display === \"1\"\n      )) ||\n    [];\n\n  if (!vendorData) {\n    return null;\n  }\n\n  return (\n    <div className={STYLES.vendorDisplay}>\n      {highVendors.length > 0 && (\n        <div className={classnames(STYLES.section, STYLES.withSeparator)}>\n          <div className={STYLES.description}>\n            These vendors are currently giving at-level engrams (to a maximum of{\" \"}\n            <Power>950</Power>) which can help you raise the power of slots\n            below your average, or to provide items for infusion:\n          </div>\n          {vendorListDisplay(highVendors, manifestData)}\n        </div>\n      )}\n      {noDataVendors.length > 0 && (\n        <div className={STYLES.section}>\n          <div className={STYLES.description}>\n            Some vendors are missing data, visit{\" \"}\n            <a\n              href=\"https://www.vendorengrams.xyz\"\n              /* eslint-disable-next-line react/jsx-no-target-blank */\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              vendorengrams.xyz\n            </a>{\" \"}\n            if you can help provide data for these vendors:\n          </div>\n          {vendorListDisplay(noDataVendors, manifestData)}\n        </div>\n      )}\n\n      <div className={STYLES.section}>\n        <div>\n          Data provided by{\" \"}\n          <a\n            href=\"https://www.vendorengrams.xyz\"\n            /* eslint-disable-next-line react/jsx-no-target-blank */\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            vendorengrams.xyz\n          </a>\n          {vendorsLastCheckedString && (\n            <>, last updated {vendorsLastCheckedString} ago.</>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import {\r\n  DestinyCharacterComponent,\r\n  DestinyInventoryComponent,\r\n  DestinyItemComponent,\r\n  DestinyItemInstanceComponent,\r\n  DestinyProfileProgressionComponent,\r\n  DestinyProfileResponse,\r\n  ServerResponse\r\n} from \"bungie-api-ts/destiny2\";\r\n\r\nimport forIn from \"lodash/forIn\";\r\nimport groupBy from \"lodash/groupBy\";\r\nimport mapValues from \"lodash/mapValues\";\r\nimport maxBy from \"lodash/maxBy\";\r\nimport sumBy from \"lodash/sumBy\";\r\n\r\nimport {\r\n  CLASS_NAMES,\r\n  CLASS_TYPE_ALL,\r\n  ITEM_BUCKET_SLOTS,\r\n  ITEM_SLOT_BUCKETS,\r\n  ITEM_TYPE_ARMOR,\r\n  ITEM_TYPE_WEAPON,\r\n  UNDYING_ARTIFACT_ITEM_HASH\r\n} from \"../constants\";\r\nimport {\r\n  CharacterData,\r\n  ItemBySlot,\r\n  JoinedItemDefinition,\r\n  PowerBySlot,\r\n  SeasonalArtifactData\r\n} from \"../types\";\r\nimport {\r\n  getBasicProfile,\r\n  getFullProfile,\r\n  getManifest,\r\n  GetManifestResult,\r\n  ManifestData\r\n} from \"./bungie-api\";\r\nimport { auth, getSelectedDestinyMembership } from \"./bungie-auth\";\r\n\r\nconst getPowerBySlot = (itemsBySlot: ItemBySlot): PowerBySlot =>\r\n  mapValues(itemsBySlot, item =>\r\n    item && item.instanceData ? item.instanceData.primaryStat.value : 0\r\n  );\r\n\r\nconst getAveragePower = (powerBySlot: PowerBySlot) =>\r\n  Object.values(powerBySlot).reduce((sum, power) => sum + power, 0) /\r\n  Object.keys(ITEM_SLOT_BUCKETS).length;\r\nconst getOverallPower = (powerBySlot: PowerBySlot) =>\r\n  Math.floor(getAveragePower(powerBySlot));\r\n\r\nconst mergeItems = <\r\n  T extends { [key: string]: { items: DestinyItemComponent[] } }\r\n>(\r\n  characterItemMap: T\r\n) => {\r\n  return Object.values(characterItemMap).reduce(\r\n    (allItems, characterItems) => allItems.concat(characterItems.items),\r\n    [] as DestinyItemComponent[]\r\n  );\r\n};\r\n\r\nconst isItemEquippableByCharacter = (\r\n  item: JoinedItemDefinition,\r\n  character: DestinyCharacterComponent\r\n) => {\r\n  if (!item.instanceData) {\r\n    return false;\r\n  }\r\n  if (item.instanceData.canEquip) {\r\n    return true;\r\n  } // If the game says we can equip it, let's believe it\r\n  if (item.instanceData.cannotEquipReason === 16) {\r\n    return true;\r\n  } // Only reason is that it's in your vault\r\n  if (item.instanceData.equipRequiredLevel > character.baseCharacterLevel) {\r\n    return false;\r\n  }\r\n  if (\r\n    item.itemDefinition.classType !== CLASS_TYPE_ALL &&\r\n    item.itemDefinition.classType !== character.classType\r\n  ) {\r\n    return false;\r\n  }\r\n  // Let's ignore the rest for now\r\n  return true;\r\n};\r\n\r\nconst getBasicCharacterData = async (\r\n  pendingBasicProfile: ReturnType<typeof getBasicProfile>\r\n) => {\r\n  const profile = await pendingBasicProfile;\r\n  if (!profile || !profile.Response || !profile.Response.characters) {\r\n    return;\r\n  }\r\n  const characters = profile.Response.characters.data;\r\n\r\n  if (characters) {\r\n    const getBasicDataForCharacterId = (id: string): CharacterData => {\r\n      const character = characters[id];\r\n      const className = CLASS_NAMES[character.classType];\r\n      const result: CharacterData = {\r\n        character,\r\n        className,\r\n        overallPowerExact: character.light,\r\n        overallPower: character.light\r\n      };\r\n      return result;\r\n    };\r\n\r\n    const characterIds = Object.keys(characters);\r\n    const characterData = characterIds.map(id =>\r\n      getBasicDataForCharacterId(id)\r\n    );\r\n    return characterData;\r\n  }\r\n};\r\n\r\ninterface ObjectOf<T> {\r\n  [key: string]: T;\r\n}\r\n\r\nconst mapAndFilterItems = (\r\n  items: DestinyItemComponent[],\r\n  manifest: ManifestData,\r\n  itemInstances: ObjectOf<DestinyItemInstanceComponent>,\r\n  character: DestinyCharacterComponent\r\n): JoinedItemDefinition[] =>\r\n  items\r\n    .map(item => {\r\n      const instanceData = item.itemInstanceId\r\n        ? itemInstances[item.itemInstanceId]\r\n        : undefined;\r\n      const itemDefinition =\r\n        manifest.DestinyInventoryItemDefinition[item.itemHash];\r\n      return {\r\n        ...item,\r\n        instanceData,\r\n        itemDefinition\r\n      };\r\n    })\r\n    .filter(\r\n      i =>\r\n        i.instanceData &&\r\n        i.itemDefinition &&\r\n        [ITEM_TYPE_ARMOR, ITEM_TYPE_WEAPON].includes(i.itemDefinition.itemType)\r\n    )\r\n    .map(i => ({\r\n      ...i,\r\n      instanceData: i.instanceData!,\r\n      itemDefinition: i.itemDefinition!\r\n    }))\r\n    .map(i => ({\r\n      ...i,\r\n      slotName: ITEM_BUCKET_SLOTS[i.itemDefinition.inventory.bucketTypeHash]\r\n    }))\r\n    .filter(i => i.instanceData.primaryStat && i.instanceData.primaryStat.value)\r\n    .filter(i => isItemEquippableByCharacter(i, character));\r\n\r\nconst getItemScore = (item?: JoinedItemDefinition) => {\r\n  if (!item || !item.instanceData || !item.instanceData.primaryStat) {\r\n    return 0;\r\n  }\r\n  let score = item.instanceData.primaryStat.value;\r\n  if (item.instanceData.isEquipped) {\r\n    score += 0.1;\r\n  }\r\n  if (item.location === 1) {\r\n    score += 0.05;\r\n  }\r\n  return score;\r\n};\r\n\r\nconst getEquipLabel = (item?: JoinedItemDefinition) =>\r\n  item && item.itemDefinition.equippingBlock.uniqueLabel;\r\n\r\nconst getEmblemData = (\r\n  character: DestinyCharacterComponent,\r\n  manifest: ManifestData\r\n) => {\r\n  if (!manifest) {\r\n    return;\r\n  }\r\n  return manifest.DestinyInventoryItemDefinition[character.emblemHash];\r\n};\r\n\r\nconst getDataForCharacterId = (\r\n  characterId: string,\r\n  characters: ObjectOf<DestinyCharacterComponent>,\r\n  itemInstances: ObjectOf<DestinyItemInstanceComponent>,\r\n  manifest: ManifestData,\r\n  characterInventories: ObjectOf<DestinyInventoryComponent>,\r\n  characterEquipments: ObjectOf<DestinyInventoryComponent>,\r\n  allCharacterWeapons: DestinyItemComponent[],\r\n  profileInventories: DestinyInventoryComponent,\r\n  profileProgression: DestinyProfileProgressionComponent\r\n): CharacterData => {\r\n  const character = characters[characterId];\r\n  const className = CLASS_NAMES[character.classType];\r\n\r\n  const characterItems = mapAndFilterItems(\r\n    characterInventories[characterId].items\r\n      .concat(characterEquipments[characterId].items)\r\n      .concat(allCharacterWeapons),\r\n    manifest,\r\n    itemInstances,\r\n    character\r\n  );\r\n  const relevantProfileItems = mapAndFilterItems(\r\n    profileInventories.items,\r\n    manifest,\r\n    itemInstances,\r\n    character\r\n  ).filter(\r\n    i =>\r\n      i.itemDefinition.classType === CLASS_TYPE_ALL ||\r\n      i.itemDefinition.classType === character.classType\r\n  );\r\n\r\n  const allItems = characterItems.concat(relevantProfileItems);\r\n\r\n  // Group by slot\r\n  const itemsBySlot = groupBy(allItems, i => i.slotName);\r\n  // Get max power items per slot\r\n  let topItemBySlot: ItemBySlot = mapValues(\r\n    itemsBySlot,\r\n    items => maxBy(items, getItemScore)!\r\n  );\r\n  // Get overlaps by equip label\r\n  const uniqueEquippedGroups = groupBy(\r\n    Object.values(topItemBySlot).filter(getEquipLabel),\r\n    getEquipLabel\r\n  );\r\n  // For overlaps with more than one item, generate valid options where all-but-one item is swapped for the next best non-exotic\r\n  forIn(uniqueEquippedGroups, uniqueEquippedGroup => {\r\n    if (uniqueEquippedGroup.length <= 1) {\r\n      return;\r\n    }\r\n\r\n    const validItemCombinations: ItemBySlot[] = [];\r\n\r\n    uniqueEquippedGroup.forEach(item => {\r\n      const otherItems: JoinedItemDefinition[] = uniqueEquippedGroup\r\n        .filter(otherItem => otherItem !== item)\r\n        .filter(otherItem => !!otherItem)\r\n        .map(otherItem => otherItem!);\r\n      let isCombinationValid = true;\r\n      const combination = { ...topItemBySlot };\r\n      otherItems.forEach(otherItem => {\r\n        // Find non-exotics for this slot\r\n        const nonExotics = itemsBySlot[otherItem.slotName].filter(\r\n          i => !getEquipLabel(i)\r\n        );\r\n        if (nonExotics.length > 0) {\r\n          // Select max power from non-exotics\r\n          combination[otherItem.slotName] = maxBy(nonExotics, getItemScore)!;\r\n        } else {\r\n          // No non-exotic options for this slot, so whole combination is invalidaa\r\n          isCombinationValid = false;\r\n        }\r\n      });\r\n      if (isCombinationValid) {\r\n        validItemCombinations.push(combination);\r\n      }\r\n    });\r\n\r\n    // Select highest total scoring valid combination, if alternative item combinations have been generated\r\n    if (validItemCombinations.length > 0) {\r\n      const bestCombination = maxBy(validItemCombinations, combination =>\r\n        sumBy(Object.values(combination), getItemScore)\r\n      )!;\r\n      topItemBySlot = bestCombination;\r\n    }\r\n  });\r\n\r\n  // Mock lower kinetic weapon power level to test display of world drop hints\r\n  // (topItemBySlot.kinetic.instanceData.primaryStat as any).value = 940;\r\n\r\n  const powerBySlot = getPowerBySlot(topItemBySlot);\r\n  const overallPowerExact = getAveragePower(powerBySlot);\r\n  const overallPower = getOverallPower(powerBySlot);\r\n\r\n  const artifactItemComponent = Object.values(characterEquipments)\r\n    .flatMap(i => i.items)\r\n    .find(i => i.itemHash === UNDYING_ARTIFACT_ITEM_HASH);\r\n\r\n  let artifactData: SeasonalArtifactData | undefined;\r\n  if (artifactItemComponent && profileProgression.seasonalArtifact) {\r\n    const artifactDefinition = manifest.DestinyInventoryItemDefinition[\r\n      artifactItemComponent.itemHash\r\n    ]!;\r\n    artifactData = {\r\n      bonusPower: profileProgression.seasonalArtifact.powerBonus,\r\n      iconPath: artifactDefinition.displayProperties.icon,\r\n      name: artifactDefinition.displayProperties.name,\r\n      progressToNextLevel:\r\n        profileProgression.seasonalArtifact.powerBonusProgression\r\n          .progressToNextLevel,\r\n      nextLevelAt:\r\n        profileProgression.seasonalArtifact.powerBonusProgression.nextLevelAt\r\n    };\r\n  }\r\n\r\n  const potentialPowerBySlot = { ...powerBySlot };\r\n  while (\r\n    Object.values(potentialPowerBySlot).some(\r\n      power => power < getOverallPower(potentialPowerBySlot) || power < 900\r\n    )\r\n  ) {\r\n    const tempPotentialOverallPower = getOverallPower(potentialPowerBySlot);\r\n    Object.keys(potentialPowerBySlot).forEach(\r\n      slot =>\r\n        (potentialPowerBySlot[slot] = Math.max(\r\n          900,\r\n          Math.max(tempPotentialOverallPower, potentialPowerBySlot[slot])\r\n        ))\r\n    );\r\n  }\r\n  const potentialOverallPower = getOverallPower(potentialPowerBySlot);\r\n\r\n  const emblemData = getEmblemData(character, manifest);\r\n\r\n  const resultData: CharacterData = {\r\n    character,\r\n    className,\r\n    overallPowerExact,\r\n    overallPower,\r\n    potentialOverallPower,\r\n    topItemBySlot,\r\n    artifactData,\r\n    emblemData\r\n  };\r\n\r\n  return resultData;\r\n};\r\n\r\nexport const getCharacterData = async (\r\n  currentCharacterData: CharacterData[] | undefined,\r\n  setCharacterData: (state: CharacterData[]) => any,\r\n  setIsFetchingCharacterData: (state: boolean) => any,\r\n  returnBasicCharacterData: boolean = false\r\n) => {\r\n  try {\r\n    const isAuthed = await auth();\r\n    if (!isAuthed) {\r\n      return;\r\n    }\r\n\r\n    const pendingManifest = getManifest();\r\n\r\n    setIsFetchingCharacterData(true);\r\n\r\n    const destinyMembership = getSelectedDestinyMembership();\r\n    if (!destinyMembership) {\r\n      return;\r\n    }\r\n\r\n    let pendingBasicProfile: ReturnType<typeof getBasicProfile> | undefined;\r\n\r\n    // Flag lets this be disabled to prevent setting after full profile is returned\r\n    let shouldSetBasicCharacterData = true;\r\n    // Produce basic data if flag is set\r\n    if (returnBasicCharacterData) {\r\n      pendingBasicProfile = getBasicProfile(\r\n        destinyMembership.membershipType,\r\n        destinyMembership.membershipId\r\n      );\r\n      pendingBasicProfile.catch(() => {\r\n        /* Do nothing */\r\n      });\r\n      const pendingBasicCharacterData = getBasicCharacterData(\r\n        pendingBasicProfile\r\n      ).catch(e => {\r\n        /* Do nothing */\r\n      });\r\n      (async () => {\r\n        const basicCharacterData = await pendingBasicCharacterData;\r\n        if (basicCharacterData && shouldSetBasicCharacterData) {\r\n          setCharacterData(basicCharacterData);\r\n        }\r\n      })();\r\n    }\r\n\r\n    let fullProfile: ServerResponse<DestinyProfileResponse> | undefined;\r\n    try {\r\n      fullProfile = await getFullProfile(\r\n        destinyMembership.membershipType,\r\n        destinyMembership.membershipId\r\n      );\r\n    } catch (e) {\r\n      if (e.message === \"401\") {\r\n        await auth();\r\n      }\r\n    }\r\n    setIsFetchingCharacterData(false);\r\n\r\n    if (\r\n      !fullProfile ||\r\n      !fullProfile.Response ||\r\n      !fullProfile.Response.characters ||\r\n      !fullProfile.Response.characters.data ||\r\n      !fullProfile.Response.characterEquipment ||\r\n      !fullProfile.Response.characterEquipment.data ||\r\n      !fullProfile.Response.characterInventories ||\r\n      !fullProfile.Response.characterInventories.data ||\r\n      !fullProfile.Response.profileInventory ||\r\n      !fullProfile.Response.profileInventory.data ||\r\n      !fullProfile.Response.itemComponents ||\r\n      !fullProfile.Response.itemComponents.instances ||\r\n      !fullProfile.Response.itemComponents.instances.data ||\r\n      !fullProfile.Response.profileProgression ||\r\n      !fullProfile.Response.profileProgression.data\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const characters = fullProfile.Response.characters.data;\r\n    const characterEquipments = fullProfile.Response.characterEquipment.data;\r\n    const characterInventories = fullProfile.Response.characterInventories.data;\r\n    const profileInventories = fullProfile.Response.profileInventory.data;\r\n    const itemInstances = fullProfile.Response.itemComponents.instances.data;\r\n    const profileProgression = fullProfile.Response.profileProgression.data;\r\n\r\n    let manifestResult: GetManifestResult | undefined;\r\n    try {\r\n      manifestResult = await pendingManifest;\r\n    } catch (e) {\r\n      console.error(e);\r\n      return;\r\n    }\r\n\r\n    if (!manifestResult || !manifestResult.manifest) {\r\n      return;\r\n    }\r\n\r\n    const { manifest } = manifestResult;\r\n\r\n    const allCharacterItems = mergeItems(characterInventories)\r\n      .concat(mergeItems(characterEquipments))\r\n      .concat(profileInventories.items);\r\n    const allCharacterWeapons = allCharacterItems.filter(i => {\r\n      const itemDefinition =\r\n        i.itemHash && manifest.DestinyInventoryItemDefinition[i.itemHash];\r\n      return itemDefinition && itemDefinition.itemType === ITEM_TYPE_WEAPON;\r\n    });\r\n\r\n    const characterIds = Object.keys(characters);\r\n    const characterData = characterIds.map(id =>\r\n      getDataForCharacterId(\r\n        id,\r\n        characters,\r\n        itemInstances,\r\n        manifest,\r\n        characterInventories,\r\n        characterEquipments,\r\n        allCharacterWeapons,\r\n        profileInventories,\r\n        profileProgression\r\n      )\r\n    );\r\n    shouldSetBasicCharacterData = false;\r\n    setCharacterData(characterData);\r\n  } catch (e) {\r\n    console.error(`Error fetching manifest and character data`, e);\r\n    setIsFetchingCharacterData(false);\r\n    return;\r\n  }\r\n};\r\n","import * as bungieApi from \"./bungie-api\";\nimport * as bungieAuth from \"./bungie-auth\";\nimport * as ga from \"./ga\";\nimport * as utils from \"./utils\";\nimport * as vendors from \"./vendor-engrams\";\n\nexport interface Api {\n  bungieApi: typeof bungieApi;\n  bungieAuth: typeof bungieAuth;\n  ga: typeof ga;\n  utils: typeof utils;\n  vendors: typeof vendors;\n}\n\nexport type BungieApi = typeof bungieApi;\nexport type BungieAuth = typeof bungieAuth;\nexport type GA = typeof ga;\nexport type Utils = typeof utils;\nexport type Vendors = typeof vendors;\n\nexport interface PartialApi {\n  bungieApi?: Partial<BungieApi>;\n  bungieAuth?: Partial<BungieAuth>;\n  ga?: Partial<GA>;\n  utils?: Partial<Utils>;\n  vendors?: Partial<Vendors>;\n}\n\nexport default {\n  bungieApi,\n  bungieAuth,\n  ga,\n  utils,\n  vendors\n};\n","import useInterval from \"@use-it/interval\";\nimport { UserInfoCard } from \"bungie-api-ts/user\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport {\n  auth,\n  hasManuallyAuthed,\n  hasSelectedDestinyMembership,\n  hasValidAuth,\n  manualStartAuth,\n  setSelectedDestinyMembership\n} from \"./services/bungie-auth\";\nimport ga from \"./services/ga\";\nimport { CharacterData } from \"./types\";\n\nimport CharacterDisplay from \"./components/CharacterDisplay\";\nimport FetchSpinner from \"./components/FetchSpinner\";\nimport { Footer } from \"./components/Footer\";\nimport { Header } from \"./components/Header\";\nimport LoadingSpinner from \"./components/LoadingSpinner\";\nimport { LoginPrompt } from \"./components/LoginPrompt\";\nimport MembershipSelect from \"./components/MembershipSelect\";\nimport { VendorDisplay } from \"./components/VendorDisplay\";\nimport api from \"./services/api\";\nimport {\n  BungieSystemDisabledError,\n  getManifest,\n  ManifestData\n} from \"./services/bungie-api\";\nimport { EVENTS, useEvent } from \"./services/events\";\nimport { getCharacterData } from \"./services/utils\";\n\nimport \"normalize.css\";\nimport \"./index.css\";\n\nimport STYLES from \"./App.module.scss\";\n\nconst CHARACTER_DATA_REFRESH_TIMER = 15000;\n\nexport const AppWrapper = ({ children }: { children: JSX.Element }) => {\n  return <div className={STYLES.App}>{children}</div>;\n};\n\nconst App = () => {\n  const [disableManualLogin, setDisableManualLogin] = useState(\n    hasManuallyAuthed()\n  );\n  const [isAuthed, setIsAuthed] = useState<boolean>(hasValidAuth());\n  const [hasAuthError, setAuthError] = useState<boolean>(false);\n  const [hasSelectedMembership, setHasMembership] = useState<boolean>(\n    hasSelectedDestinyMembership()\n  );\n  const [manifestData, setManifestData] = useState<ManifestData | undefined>(\n    undefined\n  );\n  const [hasManifestError, setManifestError] = useState<boolean>(false);\n  const [isBungieSystemDisabled, setBungieSystemDisabled] = useState<boolean>(\n    false\n  );\n  const [isFetchingCharacterData, setIsFetchingCharacterData] = useState<\n    boolean\n  >(false);\n  const [characterData, setCharacterData] = useState<\n    CharacterData[] | undefined\n  >(undefined);\n\n  const [manifestState, setManifestState] = useState<string>(\"Unknown\");\n  useEvent(EVENTS.GET_MANIFEST, () => {\n    setManifestError(false);\n    setManifestState(\"Checking manifest version\");\n  });\n  useEvent(EVENTS.LOAD_MANIFEST_DATA, () =>\n    setManifestState(\"Loading manifest data\")\n  );\n  useEvent(EVENTS.FETCH_MANIFEST_DATA, () =>\n    setManifestState(\"Fetching manifest data from Bungie\")\n  );\n  useEvent(EVENTS.PARSE_MANIFEST_DATA, () =>\n    setManifestState(\"Processing manifest data\")\n  );\n  useEvent(EVENTS.STORE_MANIFEST_DATA, () =>\n    setManifestState(\"Saving manifest data\")\n  );\n  useEvent(EVENTS.MANIFEST_DATA_READY, () => {\n    setManifestError(false);\n    setManifestState(\"Manifest ready\");\n  });\n  useEvent(EVENTS.LOG_OUT, () => {\n    setIsAuthed(false);\n    setDisableManualLogin(false);\n  });\n\n  const hasManifestData = manifestState === \"Manifest ready\";\n\n  useEffect(() => {\n    const doAuth = async () => {\n      const authResult = await auth();\n      if (authResult) {\n        setIsAuthed(true);\n        setAuthError(false);\n      } else {\n        setIsAuthed(false);\n        setAuthError(true);\n      }\n    };\n    if (!isAuthed) {\n      doAuth();\n    }\n  }, [isAuthed]);\n\n  const doGetManifest = useCallback(() => {\n    (async () => {\n      try {\n        const manifestResult = await getManifest();\n        if (manifestResult.error) {\n          console.error(manifestResult.error.message);\n          setManifestError(true);\n          if (manifestResult.error instanceof BungieSystemDisabledError) {\n            setBungieSystemDisabled(true);\n          }\n          return;\n        }\n        setManifestData(manifestResult.manifest);\n      } catch (e) {\n        console.error(e);\n        setManifestError(true);\n      }\n    })();\n  }, [setManifestData, setManifestError]);\n\n  useEffect(() => doGetManifest(), [doGetManifest]);\n\n  useEvent(EVENTS.MANIFEST_FETCH_ERROR, () => {\n    doGetManifest();\n  });\n\n  const doGetCharacterData = useCallback(\n    (returnBasicCharacterData: boolean = false) => {\n      const updateCharacterData = (newData: CharacterData[]) => {\n        const newOverallPower = Math.max(...newData.map(c => c.overallPower));\n        const newArtifactPower = Math.max(\n          ...newData.map(c => (c.artifactData ? c.artifactData.bonusPower : 0))\n        );\n        const newTotalPower = newOverallPower + newArtifactPower;\n        ga.set({\n          dimension1: `${newOverallPower}`,\n          dimension2: `${newArtifactPower}`,\n          dimension3: `${newTotalPower}`\n        });\n        setCharacterData(newData);\n      };\n\n      if (!isFetchingCharacterData) {\n        try {\n          getCharacterData(\n            characterData,\n            updateCharacterData,\n            setIsFetchingCharacterData,\n            returnBasicCharacterData\n          );\n        } catch (e) {\n          console.error(\"Error fetching character data:\", e);\n        }\n      }\n    },\n    [\n      characterData,\n      setCharacterData,\n      isFetchingCharacterData,\n      setIsFetchingCharacterData\n    ]\n  );\n\n  useInterval(() => {\n    if (isAuthed && hasSelectedMembership && !isFetchingCharacterData) {\n      doGetCharacterData();\n    }\n  }, CHARACTER_DATA_REFRESH_TIMER);\n\n  useEffect(() => {\n    if (!characterData && !isFetchingCharacterData) {\n      doGetCharacterData();\n    }\n  }, [characterData, isFetchingCharacterData, doGetCharacterData]);\n\n  const onSelectMembership = (membership: UserInfoCard) => {\n    ga.event({\n      category: \"Platform\",\n      action: \"Select platform\",\n      label: `Membership type: ${membership.membershipType}`\n    });\n    setSelectedDestinyMembership(membership);\n    setHasMembership(true);\n  };\n\n  let status: string | JSX.Element = \"\";\n  if (isBungieSystemDisabled) {\n    status = (\n      <span>\n        Bungie API disabled.\n        <br />\n        Check{\" \"}\n        <a\n          href=\"https://www.bungie.net/en/Help/Article/13125\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Bungie's server and update status page\n        </a>{\" \"}\n        for more information\n      </span>\n    );\n  } else if (hasAuthError) {\n    status = (\n      <span\n        className={STYLES.statusAuthError}\n        onClick={() => manualStartAuth()}\n      >\n        Bungie.net authentication required\n      </span>\n    );\n  } else if (hasManifestError) {\n    status = (\n      <span>\n        Error fetching manifest, <a href=\"/\">refresh page</a> to try again!\n      </span>\n    );\n  } else if (!isAuthed) {\n    status = \"Authenticating...\";\n  } else if (!hasSelectedMembership) {\n    status = \"Waiting for Destiny platform selection...\";\n  } else if (!hasManifestData) {\n    status = manifestState;\n  } else if (!characterData || characterData.length === 0) {\n    if (isFetchingCharacterData) {\n      status = \"Fetching character data...\";\n    } else {\n      status = \"No character data\";\n    }\n  }\n\n  (window as any).characterData = characterData;\n\n  if (isAuthed && characterData && characterData.length > 0) {\n    return (\n      <div className={STYLES.App}>\n        <MembershipSelect api={api} onMembershipSelect={onSelectMembership} />\n        <div className={STYLES.charactersContainer}>\n          <div className={STYLES.characters}>\n            {characterData.map(c => (\n              <CharacterDisplay key={c.character.characterId} data={c} />\n            ))}\n          </div>\n        </div>\n        <VendorDisplay manifestData={manifestData} />\n        {status && <LoadingSpinner>{status}</LoadingSpinner>}\n        {isFetchingCharacterData && <FetchSpinner />}\n        <Footer />\n      </div>\n    );\n  }\n\n  if (hasAuthError && !disableManualLogin) {\n    return (\n      <div className={STYLES.App}>\n        <Header />\n        <LoginPrompt />\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className={STYLES.App}>\n      <MembershipSelect api={api} onMembershipSelect={onSelectMembership} />\n      <LoadingSpinner>{status}</LoadingSpinner>\n      <Footer />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n}\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"lazyImage\":\"LazyImage_lazyImage__1uthL\",\"hidden\":\"LazyImage_hidden__2QOF1\",\"overlay\":\"LazyImage_overlay__1DdxB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"anchor\":\"FetchSpinner_anchor__t9fMi\",\"spinner\":\"FetchSpinner_spinner__fWLSM\",\"spin\":\"FetchSpinner_spin__3y-FA\",\"fetchSpinnerContainer\":\"FetchSpinner_fetchSpinnerContainer__W5p3H\",\"spinnerSmall\":\"FetchSpinner_spinnerSmall__3O8k6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"socialLinks\":\"SocialLinks_socialLinks__tE5C_\",\"link\":\"SocialLinks_link__39b0x\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerContainer\":\"Header_headerContainer__3s_gG\",\"header\":\"Header_header__1nMbP\",\"subHeader\":\"Header_subHeader__2FrWy\",\"author\":\"Header_author__9C9po\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loginContainer\":\"LoginPrompt_loginContainer__1ZPHL\",\"exampleImage\":\"LoginPrompt_exampleImage__BN8Hc\",\"login\":\"LoginPrompt_login__1N-f4\",\"loginButton\":\"LoginPrompt_loginButton__fXe2T\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"membershipSelect\":\"MembershipSelect_membershipSelect__vf_ZG\",\"logOut\":\"MembershipSelect_logOut___7a6z\",\"membership\":\"MembershipSelect_membership__RaveC\",\"platform_xbox\":\"MembershipSelect_platform_xbox__1ZAgU\",\"platform_psn\":\"MembershipSelect_platform_psn__WN9gB\",\"platform_steam\":\"MembershipSelect_platform_steam__1YUUA\",\"platform_blizzard\":\"MembershipSelect_platform_blizzard__1OiG6\",\"platform_stadia\":\"MembershipSelect_platform_stadia__1oWLM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"vendorDisplay\":\"VendorDisplay_vendorDisplay__2KfF5\",\"section\":\"VendorDisplay_section__3gmcN\",\"description\":\"VendorDisplay_description__1jKRn\",\"withSeparator\":\"VendorDisplay_withSeparator__3IeEO\",\"vendorList\":\"VendorDisplay_vendorList__avB43\",\"vendor\":\"VendorDisplay_vendor__gfsZ7\",\"high\":\"VendorDisplay_high__1blW6\",\"icon\":\"VendorDisplay_icon__1uL2N\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"kofiContainer\":\"KoFi_kofiContainer__397IW\",\"link\":\"KoFi_link__PfYQ2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"details\":\"PowerDetails_details__2GySY\",\"detailsRow\":\"PowerDetails_detailsRow__2cwCP\",\"detailsLabel\":\"PowerDetails_detailsLabel__2J09s\",\"detailsInlineIcon\":\"PowerDetails_detailsInlineIcon__6tpW-\",\"detailsValue\":\"PowerDetails_detailsValue__2GoPV\",\"progressBar\":\"PowerDetails_progressBar__jbsO2\",\"progressBarFill\":\"PowerDetails_progressBarFill__2w3Tf\",\"progressBarOverlay\":\"PowerDetails_progressBarOverlay__1wQS7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"hints\":\"PowerHints_hints__2cyAM\",\"hint\":\"PowerHints_hint__1b-7j\",\"worldDropHint\":\"PowerHints_worldDropHint__1eoNI\",\"powerfulHint\":\"PowerHints_powerfulHint__2ZKI7\",\"pinnacleHint\":\"PowerHints_pinnacleHint__3v3gU\",\"separator\":\"PowerHints_separator__1ghLp\",\"hintExtra\":\"PowerHints_hintExtra__1v6E5\",\"hintExtraInner\":\"PowerHints_hintExtraInner__2mokE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inlinePowerNumber\":\"Power_inlinePowerNumber__37gA_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buildStamp\":\"BuildStamp_buildStamp__1AkGm\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAEM0lEQVRoge2Y229VRRSHv93L4VJ6oU14EKHIi4ARY9BEE5UaNZJqMFGQgDEaX0xINMbwAl4QgprGa+R/IAjBoFgJD0ZFE5sAiShYwVqxobGFtmBbyDltT8csZzeHszv7dPalCjJfstPT2WvPzG/WzFozg8PhcDgcDofD4XA4HI7/P56NQqXUSmAXUA5c/g9HpQwYAXqB34BDwCdAzmTseVbyJqOU+l5dveSUUluUUgSfsBGzoS7eUP0rZIA3gU6gcaoGbQVfC9wEnAKWXS+ChRlAKzArzMBWcMzVnyptwG5gP3BMQktI5YuAlkQNK6U6rUJWPq/UxYtKDQ2VthOb7m6lstkokfC+QFBaqJT6LsR2VN6btFSk5oK9e+CrL2F4GMrKYG49NDXBo6uhvFzbHD0C+/ZCVxfkx2B2FdxxJzz9DFRXT9VCcJZ1AfcAe4C1Bl1rgPenqsSIeNgPCma2vwH798EN87UISQki/MIA3HU3vL4NDh2EnR/B7FlQ36AHJZeD7rOw7Bb4cCfUlUwGTcA3hvJGPyeXB8oPep7XnL7g1gOwbSssWapFTOQ/Sfry9PXpv7Lkqmsgk4Hx8cL34v2TJ/RMeG1rHMH/iANWBcpOeZ63JGiYPEq3tUFNTbFY0L9FWEMDVFVBbR1UVhaLFfJ5WNgIP5+E/v64vfjTUFZvMkwueCQHM2cWi70SKRevBgfkSmZk4PIl6DsftxcZQ5kxPiUXPGcOZLP+tI3JqB/A5hqdYsOkqQtcMH2XXPCtyyGbiy9YPC/rfMECmDcvTg23AysM5WeMzcVpoYhVzbCoEXp7CunHFhkkmR2yLB5fE7cHH4SUy0lqEraCR0PfyPrd+IJOQ4OD2mM2iFgJWL93wrPP6fRVmmAAkKxxFFhp+CoPfGyqzTYttYeskwKfH4C3d8D8G3VUDkbjolY9/f70aXhyHby8yaYbXwA/SdQAbgYeLGH7HrDJdB5OT7Dw2afQ8pbegMjOSTw4qUXfsx2/wlprsVGQQVlOyAVAeltLYfVjUFGhPS0erK0tFj39Ys8CD5UySP942PwIbN8B/X0wMFAIZLK2x0a12PVPTYfYr/1Z2FvKaHrOw/c/AC3vwtAQ9PTojYdE444OHaBefCnN1mQf/YS0Clyayth2DR+fWBeRaG+HVzdr0ZUV8PxGWL8hrjCJI8O+qG7gFz/1HAkVl+AS73jsK7w/zii1YZ1Su3fFrsJnsemirtRjHARLwT8At8UbLsniI3otl0XcmBSQa1g50J+L8lGSKD0cqXtBKk17+0iciCo2DNug9WMajSWgNa2KbKf0vcDhaRBiQ4+/sxqM+qFpStt6+FvglRQ6H5W/gIfjiA3D1sMTP2WjvgVY6h+6x/w68v4TrE/+H/cPH6a2xgxlnp965Dr2HSAbW1ySM7rD4XA4HA6Hw+FwXD8AfwPHcRHtjfBbbgAAAABJRU5ErkJggg==\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"footer\":\"Footer_footer__2FAPy\"};","module.exports = __webpack_public_path__ + \"static/media/example-titan-character-display-with-info-blur.1817ae29.jpg\";","module.exports = __webpack_public_path__ + \"static/media/example-titan-character-display-with-info.92b10b76.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"barWrapper\":\"PowerBar_barWrapper__3KvKd\",\"iconWrapper\":\"PowerBar_iconWrapper__1qkgg\",\"icon\":\"PowerBar_icon__3wmj5\",\"barContainer\":\"PowerBar_barContainer__2DUON\",\"barLine\":\"PowerBar_barLine__1NoBN\",\"filledBar\":\"PowerBar_filledBar__1tEU7\",\"label\":\"PowerBar_label__2dseV\",\"power\":\"PowerBar_power__3mH5r\",\"max\":\"PowerBar_max__1jyHk\",\"belowAverage\":\"PowerBar_belowAverage__usS9M\"};"],"sourceRoot":""}